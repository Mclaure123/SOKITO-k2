<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="Juego Sokoban educativo - N√∫meros y Letras">
    <title>SOKOBAN ENGINE V12.0 - HUD PERFECTO Y SIMETR√çA VISUAL</title>
    <!--
    =========================================================================
    SOKOBAN ENGINE V12.0 - HUD PERFECTO Y SIMETR√çA VISUAL
    =========================================================================
    
    ‚ú® MEJORAS VISUALES V12.0:
    ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    
    **ACTUALIZACI√ìN 1 - SIMETR√çA PERFECTA CON GRID**:
       ‚ú® HUD lateral ahora tiene la MISMA ALTURA que el game-grid
       ‚ú® Alineaci√≥n vertical perfecta para dise√±o sim√©trico
       ‚ú® Aspecto profesional y ordenado garantizado
    
    **ACTUALIZACI√ìN 2 - EFECTOS DE BRILLO Y RESPLANDOR**:
       ‚ú® Stats con efecto glow al hacer hover
       ‚ú® Animaciones de pulso en elementos cr√≠ticos
       ‚ú® Gradientes animados en botones del K-PAD
       ‚ú® Sombras de ne√≥n en elementos interactivos
    
    **ACTUALIZACI√ìN 3 - TRANSICIONES FLUIDAS**:
       ‚ú® Animaciones suaves en cambios de estado
       ‚ú® Efectos de escala en hover mejorados
       ‚ú® Transiciones de color suaves y profesionales
       ‚ú® Feedback visual inmediato en todas las acciones
    
    **ACTUALIZACI√ìN 4 - JERARQU√çA VISUAL MEJORADA**:
       ‚ú® Contraste optimizado entre elementos
       ‚ú® Separadores visuales sutiles pero efectivos
       ‚ú® Iconos mejorados con efectos de sombra
       ‚ú® Tipograf√≠a con mejor legibilidad y estilo
    
    üîß MEJORAS DE C√ìDIGO V12.0:
    ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    
    **OPTIMIZACI√ìN 1 - VARIABLES CSS PERSONALIZADAS**:
       üîß Variables CSS para colores del HUD reutilizables
       üîß F√°cil personalizaci√≥n de temas
       üîß C√≥digo m√°s mantenible y escalable
    
    **OPTIMIZACI√ìN 2 - MIXINS DE ANIMACI√ìN**:
       üîß Animaciones reutilizables via @keyframes
       üîß C√≥digo DRY (Don't Repeat Yourself)
       üîß F√°cil modificaci√≥n de efectos globales
    
    **OPTIMIZACI√ìN 3 - RESPONSIVE MEJORADO**:
       üîß Media queries optimizadas para diferentes pantallas
       üîß Breakpoints claros y documentados
       üîß Adaptaci√≥n fluida en todos los dispositivos
    
    **OPTIMIZACI√ìN 4 - COMENTARIOS Y ESTRUCTURA**:
       üîß Secciones claramente delimitadas
       üîß Comentarios descriptivos en √°reas clave
       üîß C√≥digo m√°s f√°cil de mantener y extender
    
    üîì FUNCIONALIDAD V9.2 (ANTERIOR):
    ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    
    **SISTEMA DE DESBLOQUEO PROGRESIVO DE NIVELES**:
       - Al inicio del juego, solo el NIVEL 1 est√° desbloqueado
       - Los dem√°s niveles aparecen BLOQUEADOS con candado üîí
       - Al completar un nivel, se desbloquea el siguiente nivel
       - Progresi√≥n lineal: Nivel 1 ‚Üí Nivel 2 ‚Üí Nivel 3 ‚Üí etc.
       - Los niveles bloqueados son visuales: gris, sin interacci√≥n
       - Click en nivel bloqueado reproduce sonido de error
       - Doble validaci√≥n de seguridad al intentar jugar
    
    ‚ú® MEJORAS V9.1 (ANTERIORES):
    ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    
    1. **HUD LATERAL OPTIMIZADO**:
       - Ancho ampliado de 22vmin a 28vmin
       - M√°ximo ampliado a 320px (antes 250px)
       - Fuentes y espaciado mejorados para mejor legibilidad
       - Cron√≥metro LED m√°s grande y visible
       - Box-shadow mejorado con efectos de brillo
    
    2. **K-PAD MEJORADO**:
       - Botones m√°s grandes (24vmin vs 18vmin)
       - Flechas direccionales m√°s visibles (5vmin vs 4vmin)
       - Bordes m√°s gruesos (3px vs 2px)
       - Efectos de hover y activo mejorados
       - Gradientes y sombras m√°s pronunciadas
       - Efectos de brillo al pasar el mouse
       - Bot√≥n RESET m√°s prominente con animaci√≥n
    
    üîß CORRECCIONES V9.0 (ANTERIORES):
    ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    
    1. **FUNCIONES DEL CRON√ìMETRO AGREGADAS**:
       - startTimer(): Inicia el contador de tiempo
       - stopTimer(): Detiene el cron√≥metro
       - formatTime(): Formatea HH:MM:SS
       - calculateStars(): Calcula estrellas seg√∫n rendimiento
    
    2. **GENERACI√ìN ALEATORIA CORREGIDA**:
       - Los bloques NUNCA aparecen en el borde
       - Los bloques NUNCA aparecen sobre celdas destino
       - Validaci√≥n completa de posiciones
    
    3. **K-PAD FUNCIONAL**:
       - Botones direccionales (‚Üë‚Üì‚Üê‚Üí)
       - Bot√≥n Reset (R) en el centro
       - Control completo con mouse
    
    ‚úÖ RESULTADO FINAL V9.2:
    ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
    ‚úÖ Sistema de desbloqueo progresivo completamente funcional
    ‚úÖ Solo nivel 1 disponible al inicio del juego
    ‚úÖ Niveles se desbloquean al completar el anterior
    ‚úÖ Indicadores visuales claros (candado, gris, sin hover)
    ‚úÖ HUD lateral con mejor tama√±o y legibilidad
    ‚úÖ K-PAD con gr√°ficos profesionales y responsivos
    ‚úÖ Cron√≥metro funcional con estilo LED
    ‚úÖ Generaci√≥n aleatoria 100% correcta
    ‚úÖ Juego completamente optimizado y funcional
    
    =========================================================================
    -->
    <style>
        /* ============================================
           VARIABLES GLOBALES Y RESETEO
           ============================================ */
        /* ============================================
           üé® VARIABLES CSS V12.0 - OPTIMIZACI√ìN DE C√ìDIGO 1
           ============================================ */
        :root {
            /* Colores principales */
            --color-primary: #1e3a8a;
            --color-secondary: #3b82f6;
            --color-accent: #fbbf24;
            --color-success: #10b981;
            --color-error: #ef4444;
            --color-dark: #0f172a;
            --color-darker: #020617;
            --color-light: #f1f5f9;
            --color-muted: #64748b;
            
            /* V12.0: Variables espec√≠ficas del HUD */
            --hud-bg-primary: rgba(15, 23, 42, 0.98);
            --hud-bg-secondary: rgba(30, 58, 138, 0.75);
            --hud-border: rgba(59, 130, 246, 0.8);
            --hud-stat-bg: rgba(30, 58, 138, 0.4);
            --hud-stat-border: rgba(59, 130, 246, 0.3);
            
            /* Efectos de sombra */
            --shadow-glow: 0 0 10px;
            --shadow-strong: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-neon-blue: 0 0 15px rgba(59, 130, 246, 0.6);
            --shadow-neon-gold: 0 0 15px rgba(251, 191, 36, 0.6);
            
            /* Transiciones */
            --transition-fast: 0.15s;
            --transition-normal: 0.3s;
            --transition-slow: 0.5s;
            --transition-smooth: cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* ============================================
           ESTILOS BASE
           ============================================ */
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: linear-gradient(135deg, var(--color-darker) 0%, var(--color-dark) 50%, #1e293b 100%);
            color: var(--color-light);
            font-family: 'Segoe UI', 'Roboto', 'Arial', sans-serif;
            font-size: 16px;
            line-height: 1.5;
        }
        
        /* ============================================
           EFECTOS CRT (PANTALLA RETRO)
           ============================================ */
        body::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: linear-gradient(
                rgba(59, 130, 246, 0.03) 50%, 
                rgba(0, 0, 0, 0.4) 50%
            );
            background-size: 100% 4px;
            z-index: 1000;
            pointer-events: none;
            opacity: 0.3;
        }
        
        body::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(18, 16, 16, 0.1);
            animation: flicker 0.15s infinite;
            z-index: 1001;
            pointer-events: none;
        }
        
        /* ============================================
           ANIMACIONES
           ============================================ */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.98);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @keyframes flicker {
            0% { opacity: 0.2; }
            20% { opacity: 0.8; }
            40% { opacity: 0.3; }
            60% { opacity: 0.9; }
            80% { opacity: 0.2; }
            100% { opacity: 0.7; }
        }
        
        @keyframes breathingGlow {
            0% {
                filter: drop-shadow(0 0 10px rgba(59, 130, 246, 0.5));
            }
            50% {
                filter: drop-shadow(0 0 30px rgba(251, 191, 36, 0.8));
            }
            100% {
                filter: drop-shadow(0 0 10px rgba(59, 130, 246, 0.5));
            }
        }
        
        @keyframes shakeError {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        /* ============================================
           üé¨ ANIMACIONES V12.0 - OPTIMIZACI√ìN DE C√ìDIGO 2
           ============================================ */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* V12.0: Animaci√≥n de resplandor suave */
        @keyframes softGlow {
            0% {
                box-shadow: 0 0 5px var(--color-secondary), 0 0 10px rgba(59, 130, 246, 0.3);
            }
            50% {
                box-shadow: 0 0 15px var(--color-secondary), 0 0 25px rgba(59, 130, 246, 0.5);
            }
            100% {
                box-shadow: 0 0 5px var(--color-secondary), 0 0 10px rgba(59, 130, 246, 0.3);
            }
        }
        
        /* V12.0: Animaci√≥n de brillo al hover */
        @keyframes shimmer {
            0% {
                background-position: -200% center;
            }
            100% {
                background-position: 200% center;
            }
        }
        
        /* V12.0: Pulso de ne√≥n */
        @keyframes neonPulse {
            0%, 100% {
                filter: drop-shadow(0 0 5px var(--color-accent));
            }
            50% {
                filter: drop-shadow(0 0 20px var(--color-accent));
            }
        }
        
        @keyframes particleFloat {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) scale(0);
                opacity: 0;
            }
        }
        
        @keyframes trailFade {
            0% {
                opacity: 0.6;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(0.8);
            }
        }
        
        @keyframes targetPulse {
            0%, 100% {
                border-color: rgba(251, 191, 36, 0.3);
                box-shadow: inset 0 0 10px rgba(251, 191, 36, 0.2);
            }
            50% {
                border-color: rgba(251, 191, 36, 0.8);
                box-shadow: inset 0 0 20px rgba(251, 191, 36, 0.5);
            }
        }
        
        @keyframes celebration {
            0% {
                transform: scale(1) rotate(0deg);
            }
            20% {
                transform: scale(1.2) rotate(10deg);
            }
            40% {
                transform: scale(0.9) rotate(-10deg);
            }
            60% {
                transform: scale(1.1) rotate(5deg);
            }
            80% {
                transform: scale(0.95) rotate(-5deg);
            }
            100% {
                transform: scale(1) rotate(0deg);
            }
        }
        
        /* ============================================
           PANTALLAS (SCREENS)
           ============================================ */
        .screen {
            position: relative;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2vmin;
            animation: fadeIn var(--transition-slow) ease-in-out;
            gap: 2vmin;
            overflow: hidden;
        }
        
        .screen.active {
            display: flex;
        }
        
        /* ============================================
           TIPOGRAF√çA
           ============================================ */
        h1 {
            font-size: clamp(2rem, 10vmin, 6rem);
            text-transform: uppercase;
            background: linear-gradient(135deg, var(--color-secondary) 0%, var(--color-accent) 50%, var(--color-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: none;
            filter: drop-shadow(0 0 20px rgba(59, 130, 246, 0.5));
            text-align: center;
            margin: 1vmin 0;
            font-weight: 800;
        }
        
        h2 {
            font-size: clamp(1rem, 4vmin, 2rem);
            text-transform: uppercase;
            color: var(--color-accent);
            text-shadow: 0 2px 10px rgba(251, 191, 36, 0.3);
            text-align: center;
            margin-bottom: 2vmin;
            font-weight: 600;
        }
        
        /* ============================================
           BOTONES
           ============================================ */
        .button {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
            border: none;
            color: white;
            padding: 2vmin 4vmin;
            font-size: clamp(0.8rem, 4vmin, 1.5rem);
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
            transition: all var(--transition-fast);
            margin: 2vmin;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            border-radius: 0.5rem;
            box-shadow: var(--shadow-strong), 0 0 20px rgba(59, 130, 246, 0.3);
        }
        
        .button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .button:hover::before {
            left: 100%;
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-strong), 0 0 30px rgba(59, 130, 246, 0.5);
        }
        
        .button:active {
            transform: scale(0.96);
        }
        
        .button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
        }
        
        .button:disabled:hover {
            transform: none;
            box-shadow: var(--shadow-strong);
        }
        
        .button-small {
            padding: 1vmin 2vmin;
            font-size: clamp(0.6rem, 2.5vmin, 1rem);
            margin: 1vmin;
        }
        
        /* ============================================
           PANTALLA DE T√çTULO
           ============================================ */
        #screen-title h1 {
            animation: breathingGlow 3s infinite ease-in-out;
        }
        
        /* ============================================
           PANTALLA DE ADMINISTRACI√ìN DE JUGADORES
           ============================================ */
        #players-list {
            max-height: 40vh;
            overflow-y: auto;
            border: 2px solid var(--color-secondary);
            background-color: rgba(15, 23, 42, 0.8);
            padding: 2vmin;
            width: 90vmin;
            max-width: 95%;
            margin: 2vmin 0;
            border-radius: 0.75rem;
            box-shadow: var(--shadow-strong);
        }
        
        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5vmin;
            margin: 1vmin 0;
            border: 1px solid rgba(59, 130, 246, 0.3);
            background: rgba(30, 58, 138, 0.3);
            cursor: pointer;
            transition: all var(--transition-fast);
            border-radius: 0.5rem;
        }
        
        .player-item:hover {
            background: rgba(59, 130, 246, 0.4);
            border-color: var(--color-secondary);
            transform: translateX(5px);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.3);
        }
        
        .player-item.selected {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
            color: white;
            border-color: var(--color-accent);
            font-weight: bold;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.4);
        }
        
        .player-delete-btn {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid var(--color-error);
            color: var(--color-error);
            padding: 0.5vmin 1.5vmin;
            font-size: clamp(0.6rem, 2vmin, 0.9rem);
            cursor: pointer;
            transition: all var(--transition-fast);
            border-radius: 0.375rem;
            font-weight: 600;
        }
        
        .player-delete-btn:hover {
            background: var(--color-error);
            color: white;
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.5);
        }
        
        /* ============================================
           PANTALLA DE SELECCI√ìN DE JUGADOR
           ============================================ */
        #player-name-display {
            border: 2px solid var(--color-secondary);
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.5) 0%, rgba(15, 23, 42, 0.8) 100%);
            padding: 2vmin 3vmin;
            font-size: clamp(1rem, 6vmin, 2rem);
            min-height: 8vmin;
            width: 90vmin;
            max-width: 95%;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            border-radius: 0.75rem;
            color: var(--color-accent);
            font-weight: 700;
            box-shadow: var(--shadow-strong), inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .shake {
            animation: shakeError var(--transition-normal) linear;
        }
        
        /* ============================================
           TECLADO VIRTUAL
           ============================================ */
        #virtual-keyboard {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 1vmin;
            width: 90vmin;
            max-width: 95%;
            padding: 2vmin 0;
        }
        
        .key {
            border: 1px solid rgba(59, 130, 246, 0.3);
            background: rgba(30, 58, 138, 0.4);
            color: var(--color-light);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: clamp(0.8rem, 3.5vmin, 1.2rem);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
            min-height: 8vmin;
            text-transform: uppercase;
            border-radius: 0.375rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .key:hover {
            border-color: var(--color-secondary);
            background: rgba(59, 130, 246, 0.5);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.4);
        }
        
        .key:active {
            transform: scale(0.96);
            background: linear-gradient(135deg, var(--color-secondary) 0%, var(--color-accent) 100%);
            color: var(--color-dark);
        }
        
        .key-enter {
            grid-column: 7 / span 2;
            background: rgba(16, 185, 129, 0.3);
            border-color: var(--color-success);
        }
        
        .key-enter:hover {
            background: rgba(16, 185, 129, 0.5);
        }
        
        .key-shift {
            grid-column: 1 / span 2;
        }
        
        .key-backspace {
            background: rgba(239, 68, 68, 0.3);
            border-color: var(--color-error);
        }
        
        .key-backspace:hover {
            background: rgba(239, 68, 68, 0.5);
        }
        
        .key.shift.active::after {
            content: '';
            position: absolute;
            top: 0.5vmin;
            right: 0.5vmin;
            width: 1vmin;
            height: 1vmin;
            background-color: var(--color-accent);
            border-radius: 50%;
            box-shadow: 0 0 5px var(--color-accent);
        }
        
        /* ============================================
           PANTALLA DE NIVELES - ARREGLADO PARA QUE QUEPAN TODOS
           ============================================ */
        #levels-welcome-message {
            display: none;
        }
        
        /* MEJORA V7.1: T√≠tulo de niveles m√°s visible */
        #screen-levels h1 {
            background: linear-gradient(135deg, var(--color-secondary) 0%, var(--color-accent) 50%, #10b981 75%, var(--color-secondary) 100%);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: breathingGlow 3s infinite ease-in-out, shimmerTitle 4s linear infinite;
            filter: drop-shadow(0 0 25px rgba(251, 191, 36, 0.6));
            font-weight: 900;
            letter-spacing: 0.1em;
        }
        
        /* MEJORA V7.1: Men√∫ de configuraci√≥n global para pantalla de niveles */
        #levels-settings-menu {
            position: absolute;
            top: 2vmin;
            right: 2vmin;
            z-index: 100;
        }
        
        #levels-settings-button {
            width: 10vmin;
            height: 10vmin;
            border-radius: 50%;
            background: rgba(59, 130, 246, 0.4);
            border: 3px solid var(--color-secondary);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 6vmin;
            font-weight: bold;
            cursor: pointer;
            transition: all var(--transition-fast);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3), 0 0 15px rgba(59, 130, 246, 0.3);
        }
        
        #levels-settings-button:hover {
            background: var(--color-secondary);
            color: white;
            box-shadow: 0 0 25px rgba(59, 130, 246, 0.8);
            transform: scale(1.15) rotate(90deg);
        }
        
        #levels-settings-button:active {
            transform: scale(0.95) rotate(0deg);
        }
        
        #levels-settings-dropdown {
            position: absolute;
            top: 110%;
            right: 0;
            margin-top: 1vmin;
            background: rgba(15, 23, 42, 0.98);
            border: 2px solid var(--color-secondary);
            border-radius: 0.75rem;
            padding: 1.5vmin;
            min-width: 35vmin;
            display: none;
            flex-direction: column;
            gap: 1vmin;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5), 0 0 30px rgba(59, 130, 246, 0.4);
            z-index: 101;
        }
        
        #levels-settings-dropdown.active {
            display: flex;
            animation: dropdownSlideIn 0.3s ease-out;
        }
        
        @keyframes dropdownSlideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .levels-settings-option {
            padding: 2vmin 2.5vmin;
            background: rgba(30, 58, 138, 0.5);
            border: 2px solid rgba(59, 130, 246, 0.4);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: clamp(0.8rem, 3vmin, 1.2rem);
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--color-light);
        }
        
        .levels-settings-option:hover {
            background: rgba(59, 130, 246, 0.6);
            border-color: var(--color-accent);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
            transform: translateX(-3px);
        }
        
        .levels-settings-option .option-icon {
            font-size: 4vmin;
            margin-right: 1vmin;
        }
        
        #levels-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.8vmin;
            width: 100%;
            max-width: 95%;
            padding: 0.5vmin;
            overflow: hidden;
            max-height: 70vh;
        }
        
        .level-button {
            border: 2px solid rgba(59, 130, 246, 0.5);
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.6) 0%, rgba(15, 23, 42, 0.8) 100%);
            padding: 1vmin 0.8vmin;
            cursor: pointer;
            transition: all var(--transition-normal);
            font-size: clamp(0.55rem, 1.6vmin, 0.85rem);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 0.2vmin;
            position: relative;
            border-radius: 0.4rem;
            box-shadow: var(--shadow-strong);
            min-height: 0;
            height: 15vh;
        }
        
        .level-button:hover {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            transform: translateY(-2px);
            box-shadow: var(--shadow-strong), 0 0 20px rgba(59, 130, 246, 0.5);
            border-color: var(--color-accent);
        }
        
        .level-button .level-title {
            font-size: clamp(0.7rem, 2.2vmin, 1.1rem);
            font-weight: 800;
            color: var(--color-accent);
            line-height: 1.2;
            text-shadow: 0 2px 8px rgba(251, 191, 36, 0.5);
            letter-spacing: 0.05em;
        }
        
        .level-button:hover .level-title {
            color: white;
            text-shadow: 0 2px 10px rgba(255, 255, 255, 0.8);
        }
        
        .level-button .level-desc {
            font-size: clamp(0.55rem, 1.6vmin, 0.85rem);
            color: var(--color-secondary);
            line-height: 1.2;
            font-weight: 600;
            text-shadow: 0 1px 3px rgba(59, 130, 246, 0.4);
        }
        
        .level-button:hover .level-desc {
            color: rgba(255, 255, 255, 0.95);
            text-shadow: 0 2px 6px rgba(255, 255, 255, 0.6);
        }
        
        .level-button.completed {
            border-color: var(--color-success);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(30, 58, 138, 0.4) 100%);
        }
        
        /* MEJORA V8: Sistema de estrellas en niveles */
        .level-stars {
            position: absolute;
            top: 0.5vmin;
            right: 0.5vmin;
            display: flex;
            gap: 0.2vmin;
            font-size: clamp(0.8rem, 2vmin, 1.2rem);
        }
        
        .level-stars .star {
            color: #fbbf24;
            text-shadow: 0 0 5px rgba(251, 191, 36, 0.8);
        }
        
        .level-stars .star.empty {
            color: rgba(255, 255, 255, 0.2);
            text-shadow: none;
        }
        
        .level-button.completed::before {
            content: '‚úì';
            position: absolute;
            bottom: 0.3vmin;
            right: 0.3vmin;
            font-size: 1.8vmin;
            color: var(--color-success);
            background: rgba(16, 185, 129, 0.2);
            border-radius: 50%;
            width: 3vmin;
            height: 3vmin;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* NUEVO V9.1: Niveles bloqueados */
        .level-button.locked {
            opacity: 0.4;
            cursor: not-allowed !important;
            pointer-events: none;
            filter: grayscale(1);
            background: linear-gradient(135deg, rgba(100, 116, 139, 0.6) 0%, rgba(71, 85, 105, 0.8) 100%);
        }
        
        .level-button.locked::after {
            content: 'üîí';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: clamp(1.5rem, 5vmin, 3rem);
            opacity: 0.8;
        }
        
        .level-button.locked:hover {
            transform: none;
            box-shadow: var(--shadow-strong);
            border-color: rgba(100, 116, 139, 0.5);
        }
        
        .level-progress {
            font-size: clamp(0.5rem, 1.6vmin, 0.8rem);
            color: var(--color-secondary);
            line-height: 1.2;
            font-weight: 700;
            text-shadow: 0 1px 3px rgba(59, 130, 246, 0.5);
        }
        
        .level-button:hover .level-progress {
            color: white;
            text-shadow: 0 2px 6px rgba(255, 255, 255, 0.6);
        }
        
        /* MEJORA V8: Sistema de estrellas en niveles */
        .level-stars {
            position: absolute;
            top: 0.5vmin;
            right: 0.5vmin;
            display: flex;
            gap: 0.2vmin;
            font-size: clamp(0.8rem, 2vmin, 1.2rem);
        }
        
        .level-stars .star {
            color: #fbbf24;
            text-shadow: 0 0 5px rgba(251, 191, 36, 0.8);
        }
        
        .level-stars .star.empty {
            color: rgba(255, 255, 255, 0.2);
            text-shadow: none;
        }
        
        .level-button.completed::before {
            content: '‚úì';
            position: absolute;
            bottom: 0.3vmin;
            right: 0.3vmin;
            font-size: 1.8vmin;
            color: var(--color-success);
            background: rgba(16, 185, 129, 0.2);
            border-radius: 50%;
            width: 3vmin;
            height: 3vmin;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* ============================================
           PANTALLA DE JUEGO
           ============================================ */
        #screen-juego {
            gap: 1vmin;
            padding: 1vmin;
            flex-direction: row;
            align-items: stretch;
        }
        
        #game-main-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1vmin;
        }
        
        #hud {
            display: none;
        }
        
        /* ENGRANAJE CON MEN√ö DESPLEGABLE */
        #settings-menu {
            position: absolute;
            top: 1vmin;
            right: 1vmin;
            z-index: 100;
        }
        
        #settings-button {
            width: 8vmin;
            height: 8vmin;
            border-radius: 50%;
            background: rgba(59, 130, 246, 0.3);
            border: 2px solid var(--color-secondary);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 5vmin;
            font-weight: bold;
            cursor: pointer;
            transition: all var(--transition-fast);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        #settings-button:hover {
            background: var(--color-secondary);
            color: white;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.6);
            transform: scale(1.1) rotate(90deg);
        }
        
        #settings-button:active {
            transform: scale(0.95);
        }
        
        #settings-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 1vmin;
            background: rgba(15, 23, 42, 0.95);
            border: 2px solid var(--color-secondary);
            border-radius: 0.5rem;
            padding: 1vmin;
            min-width: 30vmin;
            display: none;
            flex-direction: column;
            gap: 0.5vmin;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
            z-index: 101;
        }
        
        #settings-dropdown.active {
            display: flex;
        }
        
        .settings-option {
            padding: 1.5vmin 2vmin;
            background: rgba(30, 58, 138, 0.4);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 0.375rem;
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: clamp(0.7rem, 2.5vmin, 1rem);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .settings-option:hover {
            background: rgba(59, 130, 246, 0.5);
            border-color: var(--color-secondary);
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.3);
        }
        
        /* ============================================
           ‚ú® HUD LATERAL V12.0 - SIMETR√çA CON GRID (MEJORA VISUAL 1)
           ============================================ */
        #side-hud {
            width: 24vmin;
            max-width: 280px;
            /* V12.0: ALTURA ID√âNTICA AL GRID PARA SIMETR√çA PERFECTA */
            height: 85vh;
            max-height: 85vh;
            background: linear-gradient(135deg, var(--hud-bg-primary) 0%, var(--hud-bg-secondary) 100%);
            border: 2px solid var(--hud-border);
            border-radius: 0.6rem;
            padding: 0.6vmin;
            display: flex;
            flex-direction: column;
            gap: 0.4vmin;
            /* V12.0: Sombras mejoradas con efecto de profundidad (MEJORA VISUAL 2) */
            box-shadow: 
                var(--shadow-strong), 
                var(--shadow-neon-blue),
                inset 0 2px 8px rgba(0, 0, 0, 0.4),
                inset 0 -2px 4px rgba(59, 130, 246, 0.15);
            overflow-y: hidden;
            overflow-x: hidden;
            /* V12.0: Transici√≥n suave para cambios (MEJORA VISUAL 3) */
            transition: all var(--transition-normal) var(--transition-smooth);
        }
        
        /* V12.0: Efecto de resplandor animado en hover (MEJORA VISUAL 2) */
        #side-hud:hover {
            box-shadow: 
                var(--shadow-strong), 
                0 0 45px rgba(59, 130, 246, 0.7),
                inset 0 2px 8px rgba(0, 0, 0, 0.4),
                inset 0 -2px 4px rgba(59, 130, 246, 0.25);
        }
        
        /* V12.0: T√≠tulo con efecto de ne√≥n (MEJORA VISUAL 4) */
        #side-hud h3 {
            color: var(--color-accent);
            font-size: clamp(0.55rem, 1.8vmin, 0.85rem);
            text-align: center;
            border-bottom: 1px solid var(--color-secondary);
            padding-bottom: 0.3vmin;
            margin-bottom: 0.2vmin;
            background: linear-gradient(90deg, var(--color-accent), var(--color-secondary), var(--color-accent));
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmerTitle 3s linear infinite, neonPulse 2s ease-in-out infinite;
            flex-shrink: 0;
            letter-spacing: 0.05em;
            /* V12.0: Separador decorativo con gradiente */
            position: relative;
        }
        
        /* V12.0: L√≠nea decorativa bajo el t√≠tulo (MEJORA VISUAL 4) */
        #side-hud h3::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 20%;
            right: 20%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--color-accent), transparent);
            box-shadow: 0 0 8px var(--color-accent);
        }
        
        /* MEJORA VISUAL 2: Animaci√≥n de brillo en t√≠tulo */
        @keyframes shimmerTitle {
            0% { background-position: 0% center; }
            100% { background-position: 200% center; }
        }
        
        #side-hud-stats-container {
            flex: 1;
            overflow: hidden; /* V11.0: Sin scroll interno */
            display: flex;
            flex-direction: column;
            gap: 0.3vmin; /* V11.0: Gap ultra reducido */
        }
        
        /* MEJORA VISUAL 3: Scrollbar personalizado para el contenedor de stats */
        #side-hud-stats-container::-webkit-scrollbar {
            width: 6px;
        }
        
        #side-hud-stats-container::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.5);
            border-radius: 10px;
        }
        
        #side-hud-stats-container::-webkit-scrollbar-thumb {
            background: var(--color-secondary);
            border-radius: 10px;
            transition: background var(--transition-fast);
        }
        
        #side-hud-stats-container::-webkit-scrollbar-thumb:hover {
            background: var(--color-primary);
        }
        
        /* V12.0: Stats con efectos mejorados (MEJORA VISUAL 2 y 3) */
        .hud-stat {
            background: var(--hud-stat-bg);
            border: 1px solid var(--hud-stat-border);
            border-radius: 0.3rem;
            padding: 0.4vmin 0.6vmin;
            display: flex;
            flex-direction: column;
            gap: 0.1vmin;
            animation: fadeInUp 0.4s ease-out;
            transition: all var(--transition-normal) var(--transition-smooth);
            /* V12.0: Borde interno sutil */
            position: relative;
            overflow: hidden;
        }
        
        /* V12.0: Efecto de brillo al pasar el mouse (MEJORA VISUAL 2) */
        .hud-stat::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.3), transparent);
            transition: left 0.5s;
        }
        
        .hud-stat:hover::before {
            left: 100%;
        }
        
        /* V12.0: Hover mejorado con resplandor (MEJORA VISUAL 2 y 3) */
        .hud-stat:hover {
            background: rgba(59, 130, 246, 0.5);
            border-color: var(--color-secondary);
            transform: translateX(5px) scale(1.03);
            box-shadow: 
                var(--shadow-neon-blue),
                inset 0 1px 2px rgba(255, 255, 255, 0.15);
        }
        
        /* MEJORA VISUAL 5: Animaci√≥n de aparici√≥n */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* V12.0: Tipograf√≠a mejorada (MEJORA VISUAL 4) */
        .hud-stat-label {
            font-size: clamp(0.45rem, 1.2vmin, 0.65rem);
            color: var(--color-muted);
            text-transform: uppercase;
            line-height: 1.1;
            letter-spacing: 0.05em;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }
        
        .hud-stat-value {
            font-size: clamp(0.6rem, 1.6vmin, 0.9rem);
            color: var(--color-accent);
            font-weight: 700;
            line-height: 1.1;
            /* V12.0: Sombra de texto mejorada (MEJORA VISUAL 4) */
            text-shadow: 
                0 0 8px rgba(251, 191, 36, 0.6),
                0 2px 4px rgba(0, 0, 0, 0.8);
            /* V12.0: Transici√≥n suave de color (MEJORA VISUAL 3) */
            transition: all var(--transition-fast);
        }
        
        /* V12.0: Valor brillante al hover del stat (MEJORA VISUAL 2) */
        .hud-stat:hover .hud-stat-value {
            color: #fff;
            text-shadow: 
                0 0 15px rgba(251, 191, 36, 0.9),
                0 2px 6px rgba(0, 0, 0, 1);
        }
        
        /* V11.0: Cron√≥metro estilo LED compacto */
        .hud-stat.timer-display {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.9) 0%, rgba(15, 23, 42, 0.95) 100%);
            border: 1px solid var(--color-secondary);
            padding: 0.4vmin; /* V11.0: Padding reducido */
            text-align: center;
        }
        
        .hud-stat.timer-display .hud-stat-value {
            font-size: clamp(0.7rem, 2vmin, 1.1rem); /* V11.0: Reducido pero visible */
            color: #00ffff;
            font-family: 'Courier New', monospace;
            text-shadow: 
                0 0 6px #00ffff,
                0 0 10px #00ffff,
                0 0 15px rgba(0, 255, 255, 0.5);
            letter-spacing: 0.1em;
        }
        
        /* Animaci√≥n del cron√≥metro */
        @keyframes timerBlink {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0.3; }
        }
        
        .timer-colon {
            animation: timerBlink 1s infinite;
        }
        
        /* V11.0: K-PAD ULTRA COMPACTO SIN SCROLL */
        #k-pad {
            background: linear-gradient(135deg, rgba(20, 45, 115, 0.85) 0%, rgba(10, 18, 35, 0.95) 100%);
            border: 1px solid var(--color-secondary);
            border-radius: 0.5rem;
            padding: 0.4vmin; /* V11.0: Padding ultra reducido */
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.3vmin; /* V11.0: Gap m√≠nimo */
            flex-shrink: 0;
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.5), 
                inset 0 -1px 3px rgba(59, 130, 246, 0.2),
                inset 0 2px 6px rgba(0, 0, 0, 0.4);
        }
        
        #k-pad-title {
            font-size: clamp(0.5rem, 1.3vmin, 0.7rem); /* V11.0: Reducido */
            color: var(--color-accent);
            font-weight: 800;
            text-transform: uppercase;
            margin-bottom: 0.2vmin;
            letter-spacing: 0.1em;
            text-shadow: 
                0 0 8px rgba(251, 191, 36, 0.7),
                0 1px 3px rgba(0, 0, 0, 0.8);
        }
        
        /* V11.0: Botones K-PAD ultra compactos */
        #k-pad-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 0.3vmin; /* V11.0: Gap m√≠nimo */
            width: 100%;
            max-width: 14vmin; /* V11.0: Reducido al m√°ximo manteniendo usabilidad */
        }
        
        /* V12.0: Botones K-PAD con gradientes animados (MEJORA VISUAL 2) */
        .k-pad-btn {
            background: linear-gradient(135deg, rgba(25, 52, 120, 0.95) 0%, rgba(50, 110, 220, 0.8) 100%);
            background-size: 200% 200%;
            border: 1.5px solid rgba(59, 130, 246, 0.8);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: clamp(0.9rem, 3vmin, 1.5rem);
            font-weight: 900;
            cursor: pointer;
            /* V12.0: Transiciones mejoradas (MEJORA VISUAL 3) */
            transition: all var(--transition-normal) var(--transition-smooth);
            border-radius: 0.3rem;
            box-shadow: 
                0 2px 6px rgba(0, 0, 0, 0.5), 
                inset 0 1px 2px rgba(255, 255, 255, 0.25),
                0 0 8px rgba(59, 130, 246, 0.35);
            aspect-ratio: 1;
            user-select: none;
            text-shadow: 0 1px 4px rgba(0, 0, 0, 0.7);
            position: relative;
            overflow: hidden;
        }
        
        /* V12.0: Efecto de brillo animado en botones (MEJORA VISUAL 2) */
        .k-pad-btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent,
                rgba(255, 255, 255, 0.1),
                transparent
            );
            transform: rotate(45deg);
            transition: all 0.5s;
        }
        
        .k-pad-btn:hover::before {
            top: 150%;
            left: 150%;
        }
        
        /* V12.0: Hover mejorado con gradiente animado (MEJORA VISUAL 2 y 3) */
        .k-pad-btn:hover {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.95) 0%, rgba(251, 191, 36, 0.85) 100%);
            background-size: 200% 200%;
            animation: shimmer 2s ease-in-out infinite;
            box-shadow: 
                var(--shadow-neon-blue), 
                var(--shadow-neon-gold),
                0 5px 10px rgba(0, 0, 0, 0.6),
                inset 0 1px 3px rgba(255, 255, 255, 0.4);
            transform: scale(1.08) translateY(-2px);
            border-color: rgba(251, 191, 36, 0.9);
        }
        
        .k-pad-btn:active {
            transform: scale(0.92);
            box-shadow: inset 0 6px 12px rgba(0, 0, 0, 0.5);
        }
        
        .k-pad-btn-up { 
            grid-column: 2; 
            grid-row: 1;
        }
        
        .k-pad-btn-left { 
            grid-column: 1; 
            grid-row: 2;
        }
        
        .k-pad-btn-reset { 
            grid-column: 2; 
            grid-row: 2;
            background: linear-gradient(135deg, #b91c1c 0%, #dc2626 100%);
            border-color: rgba(239, 68, 68, 1);
            font-size: clamp(0.85rem, 2.8vmin, 1.4rem); /* V11.0: Reducido */
            animation: pulseShadowKpad 2s ease-in-out infinite;
            font-weight: 900;
        }
        
        .k-pad-btn-right { 
            grid-column: 3; 
            grid-row: 2;
        }
        
        .k-pad-btn-down { 
            grid-column: 2; 
            grid-row: 3;
        }
        
        @keyframes pulseShadowKpad {
            0%, 100% {
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3), 0 0 15px rgba(239, 68, 68, 0.4);
            }
            50% {
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4), 0 0 25px rgba(239, 68, 68, 0.7);
            }
        }
        
        .k-pad-btn-reset:hover {
            background: linear-gradient(135deg, #dc2626 0%, var(--color-error) 100%);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.8), 0 4px 10px rgba(0, 0, 0, 0.4);
            transform: scale(1.1) rotate(5deg);
        }
        
        .k-pad-btn-reset:active {
            transform: scale(0.9) rotate(-5deg);
        }
        
        /* V11.0: BOT√ìN SALIR COMPACTO */
        .k-pad-btn-exit {
            width: 100%;
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.9) 0%, rgba(245, 158, 11, 0.95) 100%);
            border: 2px solid rgba(251, 191, 36, 0.9);
            color: var(--color-darker);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 0.1vmin;
            padding: 0.4vmin 0.6vmin; /* V11.0: Padding ultra compacto */
            font-weight: 900;
            cursor: pointer;
            transition: all var(--transition-fast);
            border-radius: 0.4rem;
            box-shadow: 
                0 3px 8px rgba(0, 0, 0, 0.5), 
                inset 0 1px 2px rgba(255, 255, 255, 0.3),
                0 0 12px rgba(251, 191, 36, 0.4);
            user-select: none;
            margin-top: 0.4vmin; /* V11.0: Margen reducido */
        }
        
        .k-pad-btn-exit .exit-icon {
            font-size: clamp(0.9rem, 2.5vmin, 1.3rem); /* V11.0: Reducido */
            line-height: 1;
        }
        
        .k-pad-btn-exit .exit-text {
            font-size: clamp(0.5rem, 1.4vmin, 0.7rem); /* V11.0: Reducido */
            text-transform: uppercase;
            letter-spacing: 0.08em;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }
        
        .k-pad-btn-exit:hover {
            background: linear-gradient(135deg, rgba(251, 191, 36, 1) 0%, rgba(251, 146, 60, 1) 100%);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 
                0 0 25px rgba(251, 191, 36, 0.8),
                0 6px 15px rgba(0, 0, 0, 0.6),
                inset 0 1px 3px rgba(255, 255, 255, 0.5);
            border-color: rgba(251, 191, 36, 1);
        }
        
        .k-pad-btn-exit:active {
            transform: scale(0.96);
            box-shadow: inset 0 4px 8px rgba(0, 0, 0, 0.4);
        }
        
        #game-container {
            width: 100%;
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }
        
        #game-grid {
            display: grid;
            border: 3px solid var(--color-secondary);
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.4), var(--shadow-strong);
            height: 85vh;
            max-width: 95vw;
            aspect-ratio: 14 / 9;
            grid-template-columns: repeat(14, 1fr);
            grid-template-rows: repeat(9, 1fr);
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.95) 0%, rgba(30, 58, 138, 0.3) 100%);
            border-radius: 0.5rem;
        }
        
        .cell {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            position: relative;
            font-size: clamp(1rem, 4vh, 2rem);
            transition: all var(--transition-fast);
        }
        
        .wall {
            background: linear-gradient(135deg, var(--color-primary) 0%, rgba(30, 58, 138, 0.8) 100%);
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5), 0 0 5px rgba(59, 130, 246, 0.3);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        .avatar {
            background: linear-gradient(135deg, #ec4899 0%, var(--color-accent) 50%, #a855f7 100%);
            border-radius: 15%;
            box-shadow: 
                0 0 20px var(--color-accent),
                0 0 30px rgba(251, 191, 36, 0.6),
                inset 0 0 20px rgba(255, 255, 255, 0.3);
            z-index: 10;
            animation: pulse 2s infinite, avatarGlow 1.5s infinite alternate;
            border: 3px solid rgba(251, 191, 36, 0.8);
            position: relative;
        }
        
        .avatar::before {
            content: '';
            position: absolute;
            width: 30%;
            height: 30%;
            background: radial-gradient(circle, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0.5) 50%, transparent 100%);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: centerPulse 1s infinite;
        }
        
        .avatar-trail {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.4), rgba(236, 72, 153, 0.3));
            border-radius: 15%;
            animation: trailFade 0.5s ease-out forwards;
            pointer-events: none;
            z-index: 5;
        }
        
        @keyframes avatarGlow {
            0% {
                box-shadow: 
                    0 0 20px #ec4899,
                    0 0 30px #ec4899,
                    inset 0 0 20px rgba(255, 255, 255, 0.3);
            }
            100% {
                box-shadow: 
                    0 0 30px var(--color-accent),
                    0 0 40px var(--color-accent),
                    inset 0 0 30px rgba(255, 255, 255, 0.5);
            }
        }
        
        @keyframes centerPulse {
            0%, 100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.5);
                opacity: 0.5;
            }
        }
        
        .block {
            background: linear-gradient(135deg, var(--color-secondary) 0%, var(--color-primary) 100%);
            color: white;
            border: 2px solid rgba(59, 130, 246, 0.5);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            z-index: 5;
            font-weight: bold;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.5), var(--shadow-strong);
            border-radius: 0.25rem;
        }
        
        .target {
            border: 2px dashed var(--color-accent);
            background: rgba(251, 191, 36, 0.1);
            animation: targetPulse 2s infinite ease-in-out;
        }
        
        .target-number {
            color: rgba(251, 191, 36, 0.6);
            text-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
            font-size: 0.8em;
            font-weight: 700;
        }
        
        .block.on-target {
            background: linear-gradient(135deg, var(--color-success) 0%, #059669 100%);
            color: white;
            box-shadow: 0 0 25px rgba(16, 185, 129, 0.8);
            border-color: var(--color-success);
        }
        
        .block.on-target.just-placed {
            animation: celebration 0.6s ease-out;
        }
        
        .block.wrong-target {
            background-color: #FF0000;
            color: #FFFFFF;
            border: 2px solid #CC0000;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.8);
            animation: shakeError 0.3s ease-in-out;
        }
        
        .particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: radial-gradient(circle, var(--color-accent), var(--color-secondary));
            border-radius: 50%;
            pointer-events: none;
            animation: particleFloat 1s ease-out forwards;
            z-index: 15;
        }
        
        /* ============================================
           D-PAD (CONTROLES T√ÅCTILES)
           ============================================ */
        #d-pad {
            display: none;
            position: fixed;
            bottom: 3vmin;
            left: 50%;
            transform: translateX(-50%);
            width: 30vmin;
            height: 30vmin;
            grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: 1fr 1fr 1fr;
            opacity: 0.8;
            z-index: 100;
        }
        
        .d-pad-btn {
            border: 2px solid var(--color-secondary);
            background: rgba(30, 58, 138, 0.6);
            color: var(--color-light);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 5vmin;
            cursor: pointer;
            transition: all var(--transition-fast);
            border-radius: 0.5rem;
            box-shadow: var(--shadow-strong);
        }
        
        .d-pad-btn:active {
            background: linear-gradient(135deg, var(--color-secondary) 0%, var(--color-accent) 100%);
            color: white;
            transform: scale(0.95);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.6);
        }
        
        #d-pad-up { grid-area: 1 / 2 / 2 / 3; }
        #d-pad-left { grid-area: 2 / 1 / 3 / 2; }
        #d-pad-right { grid-area: 2 / 3 / 3 / 4; }
        #d-pad-down { grid-area: 3 / 2 / 4 / 3; }
        
        /* ============================================
           PANTALLA DE VICTORIA
           ============================================ */
        #screen-victoria h1 {
            animation: breathingGlow 2s infinite ease-in-out;
        }
        
        #victory-stats {
            display: flex;
            flex-direction: column;
            gap: 2vmin;
            font-size: clamp(0.9rem, 3.5vmin, 1.8rem);
            text-align: center;
            background: rgba(30, 58, 138, 0.5);
            padding: 3vmin;
            border-radius: 1rem;
            border: 2px solid var(--color-secondary);
        }
        
        #victory-stats span {
            color: var(--color-accent);
            font-weight: 700;
            text-shadow: 0 0 15px rgba(251, 191, 36, 0.6);
        }
        
        #victory-score {
            font-size: clamp(1.5rem, 6vmin, 3rem);
            color: var(--color-success);
            font-weight: 900;
            text-shadow: 0 0 20px rgba(16, 185, 129, 0.8);
        }
        
        .victory-bonus {
            font-size: clamp(0.8rem, 3vmin, 1.5rem);
            color: var(--color-accent);
            padding: 1vmin;
            background: rgba(251, 191, 36, 0.1);
            border-radius: 0.5rem;
        }
        
        /* ============================================
           PANTALLA DE LOGROS
           ============================================ */
        #achievements-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2vmin;
            width: 90%;
            max-width: 1200px;
            max-height: 70vh;
            overflow-y: auto;
            padding: 2vmin;
        }
        
        .achievement-card {
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.4) 0%, rgba(15, 23, 42, 0.6) 100%);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 0.75rem;
            padding: 2vmin;
            text-align: center;
            transition: all 0.3s;
        }
        
        .achievement-card.unlocked {
            border-color: var(--color-success);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.3) 0%, rgba(30, 58, 138, 0.4) 100%);
        }
        
        .achievement-card.locked {
            opacity: 0.5;
            filter: grayscale(1);
        }
        
        .achievement-icon {
            font-size: 4rem;
            margin-bottom: 1vmin;
        }
        
        .achievement-title {
            font-size: clamp(0.8rem, 2.5vmin, 1.2rem);
            font-weight: 700;
            color: var(--color-accent);
            margin-bottom: 0.5vmin;
        }
        
        .achievement-desc {
            font-size: clamp(0.6rem, 1.8vmin, 0.9rem);
            color: var(--color-muted);
        }
        
        /* ============================================
           MODAL DE PANTALLA COMPLETA
           ============================================ */
        #fullscreen-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            flex-direction: column;
            gap: 3vmin;
        }
        
        #fullscreen-modal.active {
            display: flex;
        }
        
        #fullscreen-modal h1 {
            animation: breathingGlow 2s infinite ease-in-out;
        }
        
        /* ============================================
           RESPONSIVE (PANTALLAS T√ÅCTILES)
           ============================================ */
        @media (hover: none) and (pointer: coarse) {
            #d-pad {
                display: grid;
            }
        }
        
        /* ============================================
           üì± RESPONSIVE V12.0 - OPTIMIZACI√ìN DE C√ìDIGO 3
           ============================================ */
        @media (orientation: portrait) {
            #screen-juego {
                flex-direction: column;
            }
            
            /* V12.0: HUD adaptativo en m√≥viles */
            #side-hud {
                width: 100%;
                max-width: none;
                height: auto;
                max-height: 30vh;
                overflow-y: auto;
            }
            
            /* V12.0: Grid adaptado a vertical */
            #game-grid {
                width: 95vw;
                height: auto;
                max-height: 60vh;
                aspect-ratio: 9 / 15;
                grid-template-columns: repeat(9, 1fr);
                grid-template-rows: repeat(15, 1fr);
            }
            
            .cell {
                font-size: clamp(0.8rem, 4vw, 1.5rem);
            }
            
            /* V12.0: Grilla de niveles optimizada */
            #levels-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 1vmin;
                padding: 0.5vmin;
            }
            
            /* V12.0: K-PAD m√°s grande en m√≥viles */
            #k-pad-buttons {
                max-width: 20vmin;
            }
        }
        
        /* V12.0: Breakpoint para pantallas peque√±as (OPTIMIZACI√ìN 3) */
        @media (max-width: 768px) {
            #side-hud {
                width: 28vmin;
            }
            
            .hud-stat {
                padding: 0.6vmin 0.8vmin;
            }
        }
        
        /* V12.0: Breakpoint para pantallas grandes (OPTIMIZACI√ìN 3) */
        @media (min-width: 1920px) {
            #side-hud {
                max-width: 320px;
            }
            
            #k-pad-buttons {
                max-width: 16vmin;
            }
        }
        
    </style>
</head>
<body>
    <div id="engine">
        <!-- Pantalla de Carga -->
        <div id="screen-preload" class="screen active">
            <h1>CARGANDO...</h1>
        </div>
        
        <!-- Pantalla de Administraci√≥n de Jugadores -->
        <div id="screen-admin-players" class="screen">
            <h1>ADMINISTRACI√ìN DE JUGADORES</h1>
            <div id="players-list"></div>
            <div class="button" id="add-player-button">AGREGAR JUGADOR</div>
            <div class="button" id="start-simulation-button" disabled>EMPEZAR SIMULACI√ìN</div>
        </div>
        
        <!-- Pantalla de Ingreso de Nombre -->
        <div id="screen-jugador" class="screen">
            <h1>NUEVO JUGADOR</h1>
            <h2>Ingresa tu nombre</h2>
            <div id="player-name-display"></div>
            <div id="virtual-keyboard"></div>
        </div>
        
        <!-- Pantalla de Niveles -->
        <div id="screen-levels" class="screen">
            <!-- MEJORA V7.1: Engranaje con men√∫ flotante -->
            <div id="levels-settings-menu">
                <div id="levels-settings-button" title="Configuraci√≥n">‚öô</div>
                <div id="levels-settings-dropdown">
                    <div class="levels-settings-option" id="levels-toggle-sound">
                        <span><span class="option-icon">üîä</span>Sonido</span>
                        <span id="levels-sound-status">OFF</span>
                    </div>
                    <div class="levels-settings-option" id="levels-exit-game">
                        <span><span class="option-icon">üö™</span>Salir</span>
                    </div>
                </div>
            </div>
            
            <h2 id="levels-welcome-message"></h2>
            <h1>NIVELES</h1>
            <div id="levels-grid"></div>
            <div style="display: flex; gap: 1vmin;">
                <div class="button button-small" id="achievements-button">LOGROS</div>
                <div class="button button-small" id="change-player-button">CAMBIAR JUGADOR</div>
            </div>
        </div>
        
        <!-- Pantalla de Logros -->
        <div id="screen-achievements" class="screen">
            <h1>üèÜ LOGROS</h1>
            <div id="achievements-container"></div>
            <div class="button button-small" id="back-from-achievements">VOLVER</div>
        </div>
        
        <!-- Pantalla de Juego -->
        <div id="screen-juego" class="screen">
            <div id="game-main-area">
                <div id="hud">
                    <div id="settings-menu">
                        <div id="settings-button" title="Configuraci√≥n">‚öô</div>
                        <div id="settings-dropdown">
                            <div class="settings-option" id="toggle-sound">
                                <span>Sonido</span>
                                <span id="sound-status">OFF</span>
                            </div>
                            <div class="settings-option" id="return-menu">
                                <span>Volver al Men√∫</span>
                            </div>
                        </div>
                    </div>
                    <div id="hud-level">NIVEL: 1</div>
                    <div id="hud-moves">MOVIMIENTOS: 0</div>
                    <div id="hud-pushes">EMPUJES: 0</div>
                </div>
                <div id="game-container">
                    <div id="game-grid"></div>
                </div>
            </div>
            
            <div id="side-hud">
                <h3>üìä REPORTES</h3>
                
                <!-- MEJORA 6: Contenedor scrolleable para las estad√≠sticas -->
                <div id="side-hud-stats-container">
                    <div class="hud-stat">
                        <div class="hud-stat-label">Jugador</div>
                        <div class="hud-stat-value" id="side-player-name">---</div>
                    </div>
                    <div class="hud-stat">
                        <div class="hud-stat-label">Nivel Actual</div>
                        <div class="hud-stat-value" id="side-level">1</div>
                    </div>
                    <div class="hud-stat timer-display">
                        <div class="hud-stat-label">‚è± TIEMPO</div>
                        <div class="hud-stat-value" id="side-timer">00:00:00</div>
                    </div>
                    <div class="hud-stat">
                        <div class="hud-stat-label">Movimientos</div>
                        <div class="hud-stat-value" id="side-moves">0</div>
                    </div>
                    <div class="hud-stat">
                        <div class="hud-stat-label">Empujes</div>
                        <div class="hud-stat-value" id="side-pushes">0</div>
                    </div>
                    <div class="hud-stat">
                        <div class="hud-stat-label">Bloques OK</div>
                        <div class="hud-stat-value" id="side-blocks-placed">0/8</div>
                    </div>
                    <div class="hud-stat">
                        <div class="hud-stat-label">Puntos</div>
                        <div class="hud-stat-value" id="side-score">0</div>
                    </div>
                </div>
                
                <div id="k-pad">
                    <div id="k-pad-title">‚å® K-PAD</div>
                    <div id="k-pad-buttons">
                        <div class="k-pad-btn k-pad-btn-up" data-direction="up" title="Arriba">‚ñ≤</div>
                        <div class="k-pad-btn k-pad-btn-left" data-direction="left" title="Izquierda">‚óÑ</div>
                        <div class="k-pad-btn k-pad-btn-reset" id="k-pad-reset" title="Resetear Nivel">R</div>
                        <div class="k-pad-btn k-pad-btn-right" data-direction="right" title="Derecha">‚ñ∫</div>
                        <div class="k-pad-btn k-pad-btn-down" data-direction="down" title="Abajo">‚ñº</div>
                    </div>
                </div>
                
                <!-- BOT√ìN PARA SALIR AL MEN√ö DE NIVELES -->
                <div id="exit-level-btn" class="k-pad-btn-exit" title="Volver al Men√∫ de Niveles">
                    <span class="exit-icon">üö™</span>
                    <span class="exit-text">SALIR</span>
                </div>
            </div>
        </div>
        
        <!-- Pantalla de Victoria -->
        <div id="screen-victoria" class="screen">
            <h1>¬°VICTORIA!</h1>
            <div id="victory-stars"></div>
            <div id="victory-stats">
                <div id="victory-score">PUNTUACI√ìN: <span>0</span></div>
                <div id="victory-moves">MOVIMIENTOS: <span>0</span></div>
                <div id="victory-pushes">EMPUJES: <span>0</span></div>
                <div id="victory-time">TIEMPO: <span>0:00</span></div>
                <div id="victory-bonuses"></div>
            </div>
            <div class="button" id="back-to-levels">VOLVER A NIVELES</div>
        </div>
    </div>
    
    <div id="fullscreen-modal">
        <h1>‚ö† PANTALLA COMPLETA REQUERIDA ‚ö†</h1>
        <h2>Debes estar en modo pantalla completa para continuar</h2>
        <div class="button" id="return-fullscreen-button">VOLVER A PANTALLA COMPLETA</div>
    </div>
    
    <div id="d-pad">
        <div class="d-pad-btn" id="d-pad-up">‚ñ≤</div>
        <div class="d-pad-btn" id="d-pad-left">‚óÑ</div>
        <div class="d-pad-btn" id="d-pad-right">‚ñ∫</div>
        <div class="d-pad-btn" id="d-pad-down">‚ñº</div>
    </div>
    
    <script>
    (function() {
        'use strict';
        
        var gameState = {
            currentScreen: 'preload',
            currentPlayer: '',
            currentLevel: 0,
            avatarPos: { x: 0, y: 0 },
            moves: 0,
            pushes: 0,
            levelData: [],
            inGame: false,
            savedGameScreen: null,
            soundEnabled: false,
            startTime: 0,
            errors: 0,
            perfectPlacement: true,
            blocksPlaced: {},
            wrongBlocks: {},
            score: 0,
            timerInterval: null, // NUEVO V8: Intervalo del cron√≥metro
            elapsedTime: 0 // NUEVO V8: Tiempo transcurrido en segundos
        };
        
        var screens = {
            preload: document.getElementById('screen-preload'),
            adminPlayers: document.getElementById('screen-admin-players'),
            jugador: document.getElementById('screen-jugador'),
            levels: document.getElementById('screen-levels'),
            juego: document.getElementById('screen-juego'),
            victoria: document.getElementById('screen-victoria'),
            achievements: document.getElementById('screen-achievements')
        };
        
        var fullscreenModal = document.getElementById('fullscreen-modal');
        var gameGridEl = document.getElementById('game-grid');
        var hud = {
            level: document.getElementById('hud-level'),
            moves: document.getElementById('hud-moves'),
            pushes: document.getElementById('hud-pushes')
        };
        
        var profiles = {};
        var playersList = [];
        var selectedPlayerIndex = -1;
        var isShiftActive = false;
        var playerName = '';
        var isPortrait = window.matchMedia('(orientation: portrait)').matches;
        var audioContext = null;
        var fullscreenRequired = false;
        
        var CELL_TYPE = {
            EMPTY: 0,
            WALL: 1,
            AVATAR: 2,
            BLOCK_BASE: 10,
            TARGET_BASE: 30
        };
        
        // DEFINICI√ìN DE LOGROS
        var achievementsDefs = [
            { id: 'first_win', icon: 'üéØ', title: 'Primer √âxito', desc: 'Completa tu primer nivel', unlocked: false },
            { id: 'perfect_level', icon: '‚≠ê', title: 'Perfecto', desc: 'Completa un nivel sin errores', unlocked: false },
            { id: 'speed_demon', icon: '‚ö°', title: 'Rayo', desc: 'Completa un nivel en menos de 30 segundos', unlocked: false },
            { id: 'five_levels', icon: 'üèÖ', title: '5 Niveles', desc: 'Completa 5 niveles', unlocked: false },
            { id: 'all_levels', icon: 'üëë', title: 'Maestro', desc: 'Completa todos los niveles', unlocked: false },
            { id: 'minimal_moves', icon: 'üéì', title: 'Eficiente', desc: 'Completa un nivel con movimientos m√≠nimos', unlocked: false }
        ];
        
        var levelLayouts = [
            [
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1],
                [1,0,0,0,0,0,0,0,0,0,0,0,0,1],
                [1,0,0,0,0,0,0,0,0,0,0,0,0,1],
                [1,0,0,30,31,32,33,34,35,36,37,0,0,1],
                [1,0,0,0,0,0,0,0,0,0,0,0,0,1],
                [1,0,0,0,0,0,0,0,0,0,0,0,0,1],
                [1,0,0,0,0,0,0,0,0,0,0,0,0,1],
                [1,0,0,0,0,0,0,0,0,0,0,0,0,1],
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1]
            ]
        ];
        
        var levelLayoutsPortrait = [
            [
                [1,1,1,1,1,1,1,1,1],
                [1,0,0,0,0,0,0,0,1],
                [1,0,0,0,0,0,0,0,1],
                [1,0,0,0,0,0,0,0,1],
                [1,0,30,0,0,0,0,0,1],
                [1,0,31,0,0,0,0,0,1],
                [1,0,32,0,0,0,0,0,1],
                [1,0,33,0,0,0,0,0,1],
                [1,0,34,0,0,0,0,0,1],
                [1,0,35,0,0,0,0,0,1],
                [1,0,36,0,0,0,0,0,1],
                [1,0,37,0,0,0,0,0,1],
                [1,0,0,0,0,0,0,0,1],
                [1,0,0,0,0,0,0,0,1],
                [1,1,1,1,1,1,1,1,1]
            ]
        ];
        
        // NIVELES CORREGIDOS
        var levelPuzzles = [
            {
                title: 'NIVEL 1',
                description: 'N√öMEROS',
                labels: ['0', '1', '2', '3', '4', '5', '6', '7']
            },
            {
                title: 'NIVEL 2',
                description: 'LETRAS',
                labels: ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H']
            },
            {
                title: 'NIVEL 3',
                description: 'VOCALES',
                labels: ['A', 'E', 'I', 'O', 'U', '√Å', '√â', '√ç']  // CORREGIDO: Sin duplicados
            },
            {
                title: 'NIVEL 4',
                description: 'COLORES',
                labels: ['‚óè', '‚óè', '‚óè', '‚óè', '‚óè', '‚óè', '‚óè', '‚óè']  // CORREGIDO: S√≠mbolos universales en lugar de emojis
            },
            {
                title: 'NIVEL 5',
                description: 'FORMAS',
                labels: ['‚¨§', '‚ñ≤', '‚ñ†', '‚óÜ', '‚ú¶', '‚¨ü', '‚¨°', '‚óØ']
            },
            {
                title: 'NIVEL 6',
                description: 'ANIMALES',
                labels: ['üêï', 'üêà', 'üêÅ', 'üêò', 'ü¶Å', 'üêØ', 'üêº', 'üê∞']
            },
            {
                title: 'NIVEL 7',
                description: 'FRUTAS',
                labels: ['üçé', 'üçä', 'üçå', 'üçá', 'üçì', 'üçâ', 'üçë', 'üçç']
            },
            {
                title: 'NIVEL 8',
                description: 'S√çMBOLOS',
                labels: ['@', '#', '$', '%', '&', '*', '+', '=']
            },
            {
                title: 'NIVEL 9',
                description: 'EMOJIS',
                labels: ['üòÄ', 'üòé', 'ü•≥', 'üòç', 'ü§ñ', 'üëΩ', 'üé≠', 'üé™']
            },
            {
                title: 'NIVEL 10',
                description: 'PLANETAS',
                labels: ['‚òø', '‚ôÄ', '‚äï', '‚ôÇ', '‚ôÉ', '‚ôÑ', '‚ôÖ', '‚ôÜ']
            },
            {
                title: 'NIVEL 11',
                description: 'M√öSICA',
                labels: ['‚ô©', '‚ô™', '‚ô´', '‚ô¨', 'ùÑû', 'ùÑ¢', '‚ô≠', '‚ôØ']
            },
            {
                title: 'NIVEL 12',
                description: 'ESTRELLAS',
                labels: ['‚òÖ', '‚ú¶', '‚úß', '‚ú©', '‚ú™', '‚ú´', '‚ú¨', '‚ú≠']
            },
            {
                title: 'NIVEL 13',
                description: 'CARTAS',
                labels: ['‚ô†', '‚ô•', '‚ô¶', '‚ô£', 'A', 'K', 'Q', 'J']
            },
            {
                title: 'NIVEL 14',
                description: 'CLIMA',
                labels: ['‚òÄ', '‚òÅ', '‚õÖ', 'üåß', '‚õà', 'üå©', '‚ùÑ', 'üåà']
            },
            {
                title: 'NIVEL 15',
                description: 'GRIEGO',
                labels: ['Œ±', 'Œ≤', 'Œ≥', 'Œ¥', 'Œµ', 'Œ∂', 'Œ∑', 'Œ∏']
            },
            {
                title: 'NIVEL 16',
                description: 'MEZCLA',
                labels: ['Œ©', 'Œ£', 'œÄ', 'Œª', 'Œº', 'Œ¶', 'Œ®', 'Œû']
            }
        ];
        
        // Agregar colores espec√≠ficos a los bloques del nivel de colores
        var colorMapping = ['#FF0000', '#FFA500', '#FFFF00', '#00FF00', '#0000FF', '#800080', '#8B4513', '#000000'];
        
        function initAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            } catch (e) {
                console.log('Audio no disponible');
            }
        }
        
        function playSound(type) {
            if (!audioContext || !gameState.soundEnabled) return;
            
            var oscillator = audioContext.createOscillator();
            var gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
            
            if (type === 'click') {
                oscillator.type = 'triangle';
                oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.1);
            } else if (type === 'move') {
                oscillator.type = 'square';
                oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.05);
            } else if (type === 'error') {
                oscillator.type = 'sawtooth';
                oscillator.frequency.setValueAtTime(150, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.2);
                gameGridEl.classList.add('shake');
                setTimeout(function() {
                    gameGridEl.classList.remove('shake');
                }, 300);
            } else if (type === 'victory') {
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.5);
            }
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }
        
        function createParticles(x, y) {
            for (var i = 0; i < 8; i++) {
                var particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                
                var angle = (Math.PI * 2 * i) / 8;
                var distance = 50 + Math.random() * 50;
                var tx = Math.cos(angle) * distance;
                var ty = Math.sin(angle) * distance;
                
                particle.style.setProperty('--tx', tx + 'px');
                particle.style.setProperty('--ty', ty + 'px');
                
                document.body.appendChild(particle);
                
                setTimeout(function(p) {
                    return function() {
                        if (p.parentNode) p.parentNode.removeChild(p);
                    };
                }(particle), 1000);
            }
        }
        
        function createAvatarTrail(avatarElement) {
            var trail = document.createElement('div');
            trail.className = 'avatar-trail';
            avatarElement.appendChild(trail);
            
            setTimeout(function() {
                if (trail.parentNode) trail.parentNode.removeChild(trail);
            }, 500);
        }
        
        function generateRandomEntities(isPortraitMode) {
            var gridWidth = isPortraitMode ? 9 : 14;
            var gridHeight = isPortraitMode ? 15 : 9;
            var minDistance = 2; // CORREGIDO V9: Distancia m√≠nima del borde
            
            var usedPositions = [];
            var baseLayout = isPortraitMode ? levelLayoutsPortrait[0] : levelLayouts[0];
            
            function isPositionValid(x, y) {
                // CORREGIDO V9: Verificar que NO est√© en el borde
                if (x < minDistance || x >= gridWidth - minDistance || 
                    y < minDistance || y >= gridHeight - minDistance) {
                    return false;
                }
                
                // CORREGIDO V9: Verificar que NO est√© sobre una celda destino (TARGET)
                var baseValue = baseLayout[y][x];
                if (baseValue >= CELL_TYPE.TARGET_BASE) {
                    return false;
                }
                
                // Verificar que la posici√≥n no est√© ocupada
                for (var i = 0; i < usedPositions.length; i++) {
                    if (usedPositions[i].x === x && usedPositions[i].y === y) {
                        return false;
                    }
                }
                
                return true;
            }
            
            function getRandomPosition() {
                var attempts = 0;
                var maxAttempts = 200; // Aumentado para dar m√°s intentos
                
                while (attempts < maxAttempts) {
                    // CORREGIDO V9: Generar dentro del rango v√°lido
                    var x = minDistance + Math.floor(Math.random() * (gridWidth - 2 * minDistance));
                    var y = minDistance + Math.floor(Math.random() * (gridHeight - 2 * minDistance));
                    
                    if (isPositionValid(x, y)) {
                        usedPositions.push({ x: x, y: y });
                        return { x: x, y: y };
                    }
                    
                    attempts++;
                }
                
                // Fallback: intentar el centro
                return { x: Math.floor(gridWidth / 2), y: Math.floor(gridHeight / 2) };
            }
            
            var avatar = getRandomPosition();
            
            var blocks = [];
            for (var i = 0; i < 8; i++) {
                var pos = getRandomPosition();
                blocks.push({ x: pos.x, y: pos.y, id: 10 + i });
            }
            
            return {
                avatar: avatar,
                blocks: blocks
            };
        }
        
        // NUEVO V9.1: Verificar si un nivel est√° desbloqueado
        function isLevelUnlocked(levelIndex, progress) {
            // El primer nivel siempre est√° desbloqueado
            if (levelIndex === 0) {
                return true;
            }
            // Los dem√°s niveles requieren que el anterior est√© completado
            return progress[levelIndex - 1].completed === true;
        }
        
        function populateLevelsScreen() {
            var grid = document.getElementById('levels-grid');
            if (!grid) {
                console.error('No se encontr√≥ el elemento levels-grid');
                return;
            }
            
            grid.innerHTML = '';
            
            var progress = getCurrentPlayerProgress();
            console.log('Creando botones para', levelPuzzles.length, 'niveles'); // DEBUG
            
            for (var i = 0; i < levelPuzzles.length; i++) {
                var puzzle = levelPuzzles[i];
                var levelBtn = document.createElement('div');
                levelBtn.className = 'level-button';
                levelBtn.setAttribute('data-level-index', i);
                
                // NUEVO V9.1: Verificar si el nivel est√° desbloqueado
                var unlocked = isLevelUnlocked(i, progress);
                
                if (!unlocked) {
                    levelBtn.classList.add('locked');
                    levelBtn.style.cursor = 'not-allowed';
                } else {
                    levelBtn.style.cursor = 'pointer';
                }
                
                if (progress[i].completed) {
                    levelBtn.classList.add('completed');
                }
                
                // NUEVO V8: Mostrar estrellas
                var starsContainer = document.createElement('div');
                starsContainer.className = 'level-stars';
                var stars = progress[i].stars || 0;
                for (var s = 0; s < 3; s++) {
                    var star = document.createElement('span');
                    star.className = 'star' + (s < stars ? '' : ' empty');
                    star.textContent = s < stars ? '‚òÖ' : '‚òÜ';
                    starsContainer.appendChild(star);
                }
                levelBtn.appendChild(starsContainer);
                
                var title = document.createElement('div');
                title.className = 'level-title';
                title.textContent = puzzle.title;
                
                var desc = document.createElement('div');
                desc.className = 'level-desc';
                desc.textContent = puzzle.description;
                
                var progressText = document.createElement('div');
                progressText.className = 'level-progress';
                progressText.textContent = progress[i].completed ? '‚úì ' + progress[i].moves + ' MOV' : '';
                
                levelBtn.appendChild(title);
                levelBtn.appendChild(desc);
                levelBtn.appendChild(progressText);
                
                grid.appendChild(levelBtn);
            }
            
            console.log('Botones de nivel creados:', grid.children.length); // DEBUG
        }
        
        function savePlayersList() {
            try {
                localStorage.setItem('sokoban_players', JSON.stringify(playersList));
            } catch (e) {
                console.log('Error guardando jugadores:', e);
            }
        }
        
        function loadPlayersList() {
            try {
                var data = localStorage.getItem('sokoban_players');
                if (data) {
                    playersList = JSON.parse(data);
                    if (!Array.isArray(playersList)) {
                        playersList = [];
                    }
                } else {
                    playersList = [];
                }
            } catch (e) {
                console.log('Error cargando jugadores:', e);
                playersList = [];
            }
            
            if (playersList.length === 0) {
                playersList.push('JUGADOR1');
                savePlayersList();
            }
        }
        
        function saveProfiles() {
            try {
                localStorage.setItem('sokoban_profiles', JSON.stringify(profiles));
            } catch (e) {
                console.log('Error guardando perfiles:', e);
            }
        }
        
        function loadProfiles() {
            try {
                var data = localStorage.getItem('sokoban_profiles');
                if (data) {
                    profiles = JSON.parse(data);
                } else {
                    profiles = {};
                }
            } catch (e) {
                console.log('Error cargando perfiles:', e);
                profiles = {};
            }
        }
        
        function getCurrentPlayerProgress() {
            if (!profiles[gameState.currentPlayer]) {
                var initialProgress = [];
                for (var i = 0; i < levelPuzzles.length; i++) {
                    initialProgress.push({ completed: false, moves: null, score: 0, stars: 0 });
                }
                profiles[gameState.currentPlayer] = { 
                    progress: initialProgress,
                    achievements: JSON.parse(JSON.stringify(achievementsDefs))
                };
            }
            
            var currentProgress = profiles[gameState.currentPlayer].progress;
            if (currentProgress.length < levelPuzzles.length) {
                var diff = levelPuzzles.length - currentProgress.length;
                for (var j = 0; j < diff; j++) {
                    currentProgress.push({ completed: false, moves: null, score: 0, stars: 0 });
                }
            }
            
            // NUEVO V8: Asegurar que todos los niveles tengan el campo stars
            for (var k = 0; k < currentProgress.length; k++) {
                if (typeof currentProgress[k].stars === 'undefined') {
                    currentProgress[k].stars = 0;
                }
            }
            
            return currentProgress;
        }
        
        function updateStartButton() {
            var startButton = document.getElementById('start-simulation-button');
            if (selectedPlayerIndex >= 0 && selectedPlayerIndex < playersList.length) {
                startButton.disabled = false;
                startButton.style.opacity = '1';
            } else {
                startButton.disabled = true;
                startButton.style.opacity = '0.4';
            }
        }
        
        function renderPlayersList() {
            var playersListEl = document.getElementById('players-list');
            playersListEl.innerHTML = '';
            
            if (playersList.length === 0) {
                playersListEl.innerHTML = '<div style="text-align: center; padding: 2vmin;">No hay jugadores registrados</div>';
                updateStartButton();
                return;
            }
            
            for (var i = 0; i < playersList.length; i++) {
                var playerItem = document.createElement('div');
                playerItem.className = 'player-item';
                if (i === selectedPlayerIndex) {
                    playerItem.classList.add('selected');
                }
                playerItem.setAttribute('data-index', i);
                
                var playerNameEl = document.createElement('span');
                playerNameEl.textContent = playersList[i];
                
                var deleteBtn = document.createElement('button');
                deleteBtn.className = 'player-delete-btn';
                deleteBtn.textContent = 'ELIMINAR';
                deleteBtn.setAttribute('data-index', i);
                
                playerItem.appendChild(playerNameEl);
                playerItem.appendChild(deleteBtn);
                
                playersListEl.appendChild(playerItem);
            }
            
            updateStartButton();
        }
        
        function createVirtualKeyboard() {
            var keys = [
                'Q', 'W', 'E', 'R', 'T', 'Y', 'U', 'BACKSPACE',
                'A', 'S', 'D', 'F', 'G', 'H', 'ENTER',
                'I', 'J', 'K', 'L', 'M', '√ë',
                'O', 'P',
                'SHIFT', 'Z', 'X', 'C', 'V', 'B', 'N'
            ];
            
            var keyLabels = {
                'BACKSPACE': '‚å´',
                'ENTER': 'ENTER',
                'SHIFT': 'SHIFT'
            };
            
            var keyboard = document.getElementById('virtual-keyboard');
            keyboard.innerHTML = '';
            
            for (var i = 0; i < keys.length; i++) {
                var key = keys[i];
                var keyEl = document.createElement('div');
                keyEl.className = 'key key-' + key.toLowerCase();
                keyEl.textContent = keyLabels[key] || key;
                keyboard.appendChild(keyEl);
            }
            
            renderKeyboard();
        }
        
        function renderKeyboard() {
            var keyElements = document.querySelectorAll('#virtual-keyboard .key');
            
            for (var i = 0; i < keyElements.length; i++) {
                var keyEl = keyElements[i];
                var text = keyEl.textContent.toLowerCase();
                
                if (text !== '‚å´' && text !== 'enter' && text !== 'shift') {
                    keyEl.textContent = isShiftActive ? text.toUpperCase() : text.toLowerCase();
                }
            }
            
            var shiftKey = document.querySelector('.key-shift');
            if (shiftKey) {
                if (isShiftActive) {
                    shiftKey.classList.add('active');
                } else {
                    shiftKey.classList.remove('active');
                }
            }
        }
        
        function updatePlayerNameDisplay() {
            document.getElementById('player-name-display').textContent = playerName || '...';
        }
        
        function updateSideHud() {
            document.getElementById('side-player-name').textContent = gameState.currentPlayer || '---';
            document.getElementById('side-level').textContent = (gameState.currentLevel + 1);
            document.getElementById('side-moves').textContent = gameState.moves;
            document.getElementById('side-pushes').textContent = gameState.pushes;
            document.getElementById('side-score').textContent = gameState.score;
            
            var baseLayout = isPortrait ? levelLayoutsPortrait[0] : levelLayouts[0];
            var correctBlocks = 0;
            var totalBlocks = 8;
            
            for (var row = 0; row < baseLayout.length; row++) {
                for (var col = 0; col < baseLayout[row].length; col++) {
                    var baseValue = baseLayout[row][col];
                    if (baseValue >= CELL_TYPE.TARGET_BASE) {
                        var expectedBlock = baseValue - 20;
                        if (gameState.levelData[row][col] === expectedBlock) {
                            correctBlocks++;
                        }
                    }
                }
            }
            
            document.getElementById('side-blocks-placed').textContent = correctBlocks + '/' + totalBlocks;
        }
        
        function calculateScore() {
            var baseScore = 1000;
            var timeElapsed = Math.floor((Date.now() - gameState.startTime) / 1000);
            
            // Bonus por tiempo
            var timeBonus = Math.max(0, 500 - (timeElapsed * 10));
            
            // Penalizaci√≥n por movimientos
            var movesPenalty = gameState.moves * 5;
            
            // Penalizaci√≥n por errores
            var errorPenalty = gameState.errors * 100;
            
            // Bonus por colocaci√≥n perfecta
            var perfectBonus = gameState.perfectPlacement ? 500 : 0;
            
            var totalScore = Math.max(0, baseScore + timeBonus - movesPenalty - errorPenalty + perfectBonus);
            
            return {
                total: Math.floor(totalScore),
                timeBonus: Math.floor(timeBonus),
                perfectBonus: perfectBonus,
                timeElapsed: timeElapsed
            };
        }
        
        function checkAchievements(scoreData) {
            var playerAchievements = profiles[gameState.currentPlayer].achievements;
            var newUnlocks = [];
            
            // Primer nivel completado
            if (!playerAchievements[0].unlocked) {
                playerAchievements[0].unlocked = true;
                newUnlocks.push(playerAchievements[0]);
            }
            
            // Nivel perfecto
            if (gameState.perfectPlacement && !playerAchievements[1].unlocked) {
                playerAchievements[1].unlocked = true;
                newUnlocks.push(playerAchievements[1]);
            }
            
            // Velocidad
            if (scoreData.timeElapsed < 30 && !playerAchievements[2].unlocked) {
                playerAchievements[2].unlocked = true;
                newUnlocks.push(playerAchievements[2]);
            }
            
            // 5 niveles
            var completedCount = 0;
            var progress = getCurrentPlayerProgress();
            for (var i = 0; i < progress.length; i++) {
                if (progress[i].completed) completedCount++;
            }
            
            if (completedCount >= 5 && !playerAchievements[3].unlocked) {
                playerAchievements[3].unlocked = true;
                newUnlocks.push(playerAchievements[3]);
            }
            
            // Todos los niveles
            if (completedCount >= levelPuzzles.length && !playerAchievements[4].unlocked) {
                playerAchievements[4].unlocked = true;
                newUnlocks.push(playerAchievements[4]);
            }
            
            // Movimientos m√≠nimos
            if (gameState.moves <= 15 && !playerAchievements[5].unlocked) {
                playerAchievements[5].unlocked = true;
                newUnlocks.push(playerAchievements[5]);
            }
            
            saveProfiles();
            
            return newUnlocks;
        }
        
        // NUEVO V9: Funciones del cron√≥metro
        function formatTime(seconds) {
            var hours = Math.floor(seconds / 3600);
            var minutes = Math.floor((seconds % 3600) / 60);
            var secs = seconds % 60;
            
            var hh = hours < 10 ? '0' + hours : hours;
            var mm = minutes < 10 ? '0' + minutes : minutes;
            var ss = secs < 10 ? '0' + secs : secs;
            
            return hh + ':' + mm + ':' + ss;
        }
        
        function startTimer() {
            gameState.elapsedTime = 0;
            gameState.timerInterval = setInterval(function() {
                gameState.elapsedTime++;
                var timerDisplay = document.getElementById('side-timer');
                if (timerDisplay) {
                    timerDisplay.textContent = formatTime(gameState.elapsedTime);
                }
            }, 1000);
        }
        
        function stopTimer() {
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
                gameState.timerInterval = null;
            }
        }
        
        function calculateStars() {
            var timeElapsed = gameState.elapsedTime;
            var moves = gameState.moves;
            var errors = gameState.errors;
            
            // ‚≠ê‚≠ê‚≠ê Perfecto: < 30 movimientos, < 60 segundos, sin errores
            if (moves < 30 && timeElapsed < 60 && errors === 0) {
                return 3;
            }
            // ‚≠ê‚≠ê Bueno: < 50 movimientos, < 120 segundos, < 5 errores
            else if (moves < 50 && timeElapsed < 120 && errors < 5) {
                return 2;
            }
            // ‚≠ê Completado
            else {
                return 1;
            }
        }
        
        function loadLevel(levelIndex) {
            var layout = isPortrait ? levelLayoutsPortrait[0] : levelLayouts[0];
            var puzzle = levelPuzzles[levelIndex];
            
            var entities = generateRandomEntities(isPortrait);
            
            gameState.levelData = [];
            for (var i = 0; i < layout.length; i++) {
                gameState.levelData[i] = layout[i].slice();
            }
            
            gameState.avatarPos = {
                x: entities.avatar.x,
                y: entities.avatar.y
            };
            gameState.levelData[entities.avatar.y][entities.avatar.x] = CELL_TYPE.AVATAR;
            
            // CORREGIDO V8: Colocar bloques y marcar los que caen en celdas destino equivocadas
            for (var j = 0; j < entities.blocks.length; j++) {
                var block = entities.blocks[j];
                gameState.levelData[block.y][block.x] = block.id;
                
                // Verificar si el bloque cay√≥ en una celda destino
                var baseValue = layout[block.y][block.x];
                if (baseValue >= CELL_TYPE.TARGET_BASE) {
                    var expectedBlock = baseValue - 20;
                    // Si NO es el bloque correcto, marcarlo como equivocado desde el inicio
                    if (block.id !== expectedBlock) {
                        var wrongKey = block.id + '_' + block.y + '_' + block.x;
                        gameState.wrongBlocks[wrongKey] = true;
                        gameState.errors++;
                        gameState.perfectPlacement = false;
                    }
                }
            }
            
            gameState.moves = 0;
            gameState.pushes = 0;
            // gameState.errors ya fue actualizado arriba si hubo bloques en destinos equivocados
            gameState.blocksPlaced = {};
            // gameState.wrongBlocks ya fue actualizado arriba
            gameState.startTime = Date.now();
            gameState.score = 0;
            
            // NUEVO V8: Iniciar cron√≥metro
            startTimer();
            
            render();
            updateSideHud();
        }
        
        function render() {
            gameGridEl.innerHTML = '';
            
            var baseLayout = isPortrait ? levelLayoutsPortrait[0] : levelLayouts[0];
            var labels = levelPuzzles[gameState.currentLevel].labels;
            
            for (var row = 0; row < gameState.levelData.length; row++) {
                for (var col = 0; col < gameState.levelData[row].length; col++) {
                    var cellValue = gameState.levelData[row][col];
                    var baseValue = baseLayout[row][col];
                    
                    var cellEl = document.createElement('div');
                    cellEl.className = 'cell';
                    
                    if (cellValue === CELL_TYPE.WALL) {
                        cellEl.classList.add('wall');
                    }
                    
                    if (baseValue >= CELL_TYPE.TARGET_BASE) {
                        cellEl.classList.add('target');
                        
                        if (cellValue >= CELL_TYPE.TARGET_BASE) {
                            var targetIndex = baseValue - CELL_TYPE.TARGET_BASE;
                            if (labels[targetIndex]) {
                                var targetLabel = document.createElement('span');
                                targetLabel.className = 'target-number';
                                targetLabel.textContent = labels[targetIndex];
                                cellEl.appendChild(targetLabel);
                            }
                        }
                    }
                    
                    if (cellValue === CELL_TYPE.AVATAR) {
                        cellEl.classList.add('avatar');
                    }
                    
                    if (cellValue >= CELL_TYPE.BLOCK_BASE && cellValue < CELL_TYPE.TARGET_BASE) {
                        var blockIndex = cellValue - CELL_TYPE.BLOCK_BASE;
                        cellEl.classList.add('block');
                        cellEl.setAttribute('data-block-id', cellValue);
                        
                        if (labels[blockIndex]) {
                            cellEl.textContent = labels[blockIndex];
                        }
                        
                        // Aplicar colores al nivel 4 (COLORES)
                        if (gameState.currentLevel === 3 && colorMapping[blockIndex]) {
                            cellEl.style.background = colorMapping[blockIndex];
                            cellEl.style.color = blockIndex === 7 ? 'white' : 'white';
                        }
                        
                        if (baseValue - 20 === cellValue) {
                            cellEl.classList.add('on-target');
                        } else if (baseValue >= CELL_TYPE.TARGET_BASE) {
                            // CORREGIDO: Solo a√±adir clase wrong-target, sin animaci√≥n aqu√≠
                            var wrongKey = cellValue + '_' + row + '_' + col;
                            if (gameState.wrongBlocks[wrongKey]) {
                                cellEl.classList.add('wrong-target');
                            }
                        }
                    }
                    
                    gameGridEl.appendChild(cellEl);
                }
            }
            
            hud.level.textContent = 'NIVEL: ' + (gameState.currentLevel + 1);
            hud.moves.textContent = 'MOVIMIENTOS: ' + gameState.moves;
            hud.pushes.textContent = 'EMPUJES: ' + gameState.pushes;
        }
        
        function handleInput(dx, dy) {
            if (!gameState.inGame) return;
            
            var currentX = gameState.avatarPos.x;
            var currentY = gameState.avatarPos.y;
            var newX = currentX + dx;
            var newY = currentY + dy;
            
            if (!gameState.levelData[newY] || gameState.levelData[newY][newX] === undefined) {
                playSound('error');
                return;
            }
            
            if (gameState.levelData[newY][newX] === CELL_TYPE.WALL) {
                playSound('error');
                return;
            }
            
            var isBlock = gameState.levelData[newY][newX] >= CELL_TYPE.BLOCK_BASE &&
                          gameState.levelData[newY][newX] < CELL_TYPE.TARGET_BASE;
            
            if (isBlock) {
                var blockNewX = newX + dx;
                var blockNewY = newY + dy;
                
                if (!gameState.levelData[blockNewY] || gameState.levelData[blockNewY][blockNewX] === undefined) {
                    playSound('error');
                    return;
                }
                
                var blockDestination = gameState.levelData[blockNewY][blockNewX];
                
                if (blockDestination === CELL_TYPE.WALL ||
                    (blockDestination >= CELL_TYPE.BLOCK_BASE && blockDestination < CELL_TYPE.TARGET_BASE)) {
                    playSound('error');
                    return;
                }
                
                var movedBlockId = gameState.levelData[newY][newX];
                var baseLayout = isPortrait ? levelLayoutsPortrait[0] : levelLayouts[0];
                var targetAtNewPos = baseLayout[blockNewY][blockNewX];
                
                // CORREGIDO: Solo crear part√≠culas y animaci√≥n si es la primera vez que se coloca correctamente
                var blockKey = movedBlockId + '_' + blockNewY + '_' + blockNewX;
                var isCorrectPlacement = targetAtNewPos >= CELL_TYPE.TARGET_BASE && targetAtNewPos - 20 === movedBlockId;
                var isFirstTimeCorrect = !gameState.blocksPlaced[blockKey];
                
                if (isCorrectPlacement && isFirstTimeCorrect) {
                    var cellRect = gameGridEl.getBoundingClientRect();
                    var cellWidth = cellRect.width / (isPortrait ? 9 : 14);
                    var cellHeight = cellRect.height / (isPortrait ? 15 : 9);
                    var particleX = cellRect.left + (blockNewX * cellWidth) + (cellWidth / 2);
                    var particleY = cellRect.top + (blockNewY * cellHeight) + (cellHeight / 2);
                    createParticles(particleX, particleY);
                    gameState.blocksPlaced[blockKey] = true;
                    gameState.score += 100;
                } else if (!isCorrectPlacement && targetAtNewPos >= CELL_TYPE.TARGET_BASE) {
                    // CORREGIDO: Marcar como error solo la primera vez
                    var wrongKey = movedBlockId + '_' + blockNewY + '_' + blockNewX;
                    if (!gameState.wrongBlocks[wrongKey]) {
                        gameState.wrongBlocks[wrongKey] = true;
                        gameState.errors++;
                        gameState.perfectPlacement = false;
                    }
                }
                
                gameState.levelData[blockNewY][blockNewX] = movedBlockId;
                gameState.pushes++;
            }
            
            gameState.levelData[newY][newX] = CELL_TYPE.AVATAR;
            
            var baseLayout = isPortrait ? levelLayoutsPortrait[0] : levelLayouts[0];
            gameState.levelData[currentY][currentX] = baseLayout[currentY][currentX];
            
            gameState.avatarPos = { x: newX, y: newY };
            gameState.moves++;
            
            playSound('move');
            render();
            
            // CORREGIDO: A√±adir animaci√≥n solo cuando se coloca por primera vez
            if (isBlock) {
                var blockCells = document.querySelectorAll('.block[data-block-id="' + movedBlockId + '"]');
                if (blockCells.length > 0) {
                    if (isCorrectPlacement && isFirstTimeCorrect) {
                        // Animaci√≥n de celebraci√≥n para bloque correcto
                        blockCells[0].classList.add('just-placed');
                        setTimeout(function(id) {
                            return function() {
                                var cell = document.querySelector('.block[data-block-id="' + id + '"]');
                                if (cell) {
                                    cell.classList.remove('just-placed');
                                }
                            };
                        }(movedBlockId), 600);
                    } else if (!isCorrectPlacement && targetAtNewPos >= CELL_TYPE.TARGET_BASE) {
                        // A√±adir clase wrong-target y animar SOLO si es primera vez en esta posici√≥n equivocada
                        var wrongKey = movedBlockId + '_' + blockNewY + '_' + blockNewX;
                        var wrongKeyPrev = movedBlockId + '_' + newY + '_' + newX;
                        
                        // Limpiar marcador previo si el bloque ven√≠a de otra celda equivocada
                        delete gameState.wrongBlocks[wrongKeyPrev];
                        
                        if (gameState.wrongBlocks[wrongKey] && !blockCells[0].classList.contains('wrong-target')) {
                            // Es la primera vez en esta posici√≥n, a√±adir clase y animar
                            blockCells[0].classList.add('wrong-target');
                        }
                    }
                }
            }
            
            var avatarCells = document.querySelectorAll('.avatar');
            if (avatarCells.length > 0) {
                createAvatarTrail(avatarCells[0]);
            }
            
            updateSideHud();
            checkWinCondition();
        }
        
        function checkWinCondition() {
            var baseLayout = isPortrait ? levelLayoutsPortrait[0] : levelLayouts[0];
            
            for (var row = 0; row < baseLayout.length; row++) {
                for (var col = 0; col < baseLayout[row].length; col++) {
                    var baseValue = baseLayout[row][col];
                    if (baseValue >= CELL_TYPE.TARGET_BASE) {
                        var expectedBlock = baseValue - 20;
                        if (gameState.levelData[row][col] !== expectedBlock) {
                            return;
                        }
                    }
                }
            }
            
            // NUEVO V8: Detener cron√≥metro
            stopTimer();
            
            gameState.inGame = false;
            playSound('victory');
            
            var scoreData = calculateScore();
            gameState.score = scoreData.total;
            
            // NUEVO V8: Calcular estrellas
            var stars = calculateStars();
            
            var progress = getCurrentPlayerProgress();
            progress[gameState.currentLevel].completed = true;
            progress[gameState.currentLevel].moves = gameState.moves;
            progress[gameState.currentLevel].score = scoreData.total;
            
            // NUEVO V8: Guardar estrellas (mantener el m√°ximo)
            if (!progress[gameState.currentLevel].stars || stars > progress[gameState.currentLevel].stars) {
                progress[gameState.currentLevel].stars = stars;
            }
            
            saveProfiles();
            
            var newAchievements = checkAchievements(scoreData);
            
            // NUEVO V8: Mostrar estrellas animadas
            var starsHtml = '';
            for (var s = 0; s < 3; s++) {
                if (s < stars) {
                    starsHtml += '<span class="victory-star">‚òÖ</span>';
                } else {
                    starsHtml += '<span class="victory-star empty">‚òÜ</span>';
                }
            }
            document.getElementById('victory-stars').innerHTML = starsHtml;
            
            // Actualizar estad√≠sticas con tiempo formateado
            document.querySelector('#victory-score span').textContent = scoreData.total;
            document.querySelector('#victory-moves span').textContent = gameState.moves;
            document.querySelector('#victory-pushes span').textContent = gameState.pushes;
            document.querySelector('#victory-time span').textContent = formatTime(gameState.elapsedTime);
            
            var bonusesEl = document.getElementById('victory-bonuses');
            bonusesEl.innerHTML = '';
            
            if (scoreData.timeBonus > 0) {
                var timeBonusDiv = document.createElement('div');
                timeBonusDiv.className = 'victory-bonus';
                timeBonusDiv.textContent = '‚ö° Bonus Velocidad: +' + scoreData.timeBonus;
                bonusesEl.appendChild(timeBonusDiv);
            }
            
            if (scoreData.perfectBonus > 0) {
                var perfectBonusDiv = document.createElement('div');
                perfectBonusDiv.className = 'victory-bonus';
                perfectBonusDiv.textContent = '‚≠ê Colocaci√≥n Perfecta: +' + scoreData.perfectBonus;
                bonusesEl.appendChild(perfectBonusDiv);
            }
            
            if (stars === 3) {
                var perfectDiv = document.createElement('div');
                perfectDiv.className = 'victory-bonus';
                perfectDiv.textContent = 'üëë ¬°NIVEL PERFECTO - 3 ESTRELLAS!';
                bonusesEl.appendChild(perfectDiv);
            }
            
            if (newAchievements.length > 0) {
                var achievDiv = document.createElement('div');
                achievDiv.className = 'victory-bonus';
                achievDiv.textContent = 'üèÜ Nuevos logros: ' + newAchievements.length;
                bonusesEl.appendChild(achievDiv);
            }
            
            showScreen('victoria');
        }
        
        function renderAchievements() {
            var container = document.getElementById('achievements-container');
            container.innerHTML = '';
            
            var playerAchievements = profiles[gameState.currentPlayer].achievements;
            
            for (var i = 0; i < playerAchievements.length; i++) {
                var ach = playerAchievements[i];
                var card = document.createElement('div');
                card.className = 'achievement-card ' + (ach.unlocked ? 'unlocked' : 'locked');
                
                var icon = document.createElement('div');
                icon.className = 'achievement-icon';
                icon.textContent = ach.icon;
                
                var title = document.createElement('div');
                title.className = 'achievement-title';
                title.textContent = ach.title;
                
                var desc = document.createElement('div');
                desc.className = 'achievement-desc';
                desc.textContent = ach.desc;
                
                card.appendChild(icon);
                card.appendChild(title);
                card.appendChild(desc);
                
                container.appendChild(card);
            }
        }
        
        function showScreen(screenId) {
            for (var key in screens) {
                if (screens.hasOwnProperty(key)) {
                    screens[key].classList.remove('active');
                }
            }
            
            if (screens[screenId]) {
                screens[screenId].classList.add('active');
                gameState.currentScreen = screenId;
            }
        }
        
        function enterFullscreen() {
            var element = document.documentElement;
            
            if (element.requestFullscreen) {
                element.requestFullscreen().catch(function(err) {
                    console.log('Error en fullscreen:', err);
                });
            } else if (element.webkitRequestFullscreen) {
                element.webkitRequestFullscreen();
            } else if (element.mozRequestFullScreen) {
                element.mozRequestFullScreen();
            } else if (element.msRequestFullscreen) {
                element.msRequestFullscreen();
            }
        }
        
        function isFullscreen() {
            return !!(document.fullscreenElement || 
                     document.webkitFullscreenElement || 
                     document.mozFullScreenElement || 
                     document.msFullscreenElement);
        }
        
        function checkFullscreenStatus() {
            if (fullscreenRequired && !isFullscreen()) {
                gameState.savedGameScreen = gameState.currentScreen;
                fullscreenModal.classList.add('active');
            } else {
                fullscreenModal.classList.remove('active');
            }
        }
        
        /* ============================================
           EVENT LISTENERS
           ============================================ */
        
        document.getElementById('start-simulation-button').addEventListener('click', function() {
            playSound('click');
            
            if (selectedPlayerIndex < 0 || selectedPlayerIndex >= playersList.length) {
                alert('Por favor selecciona un jugador');
                return;
            }
            
            gameState.currentPlayer = playersList[selectedPlayerIndex];
            document.getElementById('levels-welcome-message').textContent = 'BIENVENIDO ' + gameState.currentPlayer;
            
            fullscreenRequired = true;
            enterFullscreen();
            
            setTimeout(function() {
                showScreen('levels');
                populateLevelsScreen();
            }, 500);
        });
        
        document.getElementById('add-player-button').addEventListener('click', function() {
            playSound('click');
            playerName = '';
            updatePlayerNameDisplay();
            showScreen('jugador');
        });
        
        document.getElementById('players-list').addEventListener('click', function(e) {
            var playerItem = e.target.closest('.player-item');
            if (playerItem && !e.target.classList.contains('player-delete-btn')) {
                playSound('click');
                selectedPlayerIndex = parseInt(playerItem.getAttribute('data-index'));
                renderPlayersList();
            }
            
            if (e.target.classList.contains('player-delete-btn')) {
                playSound('error');
                var index = parseInt(e.target.getAttribute('data-index'));
                
                if (confirm('¬øEliminar jugador "' + playersList[index] + '"?')) {
                    playersList.splice(index, 1);
                    
                    if (playersList.length === 0) {
                        playersList.push('JUGADOR1');
                    }
                    
                    if (selectedPlayerIndex >= playersList.length) {
                        selectedPlayerIndex = playersList.length - 1;
                    }
                    
                    savePlayersList();
                    renderPlayersList();
                }
            }
        });
        
        document.getElementById('virtual-keyboard').addEventListener('click', function(e) {
            if (!e.target.classList.contains('key')) return;
            
            playSound('click');
            
            var key = e.target.className.match(/key-(\S+)/)[1];
            
            if (key === 'shift') {
                isShiftActive = !isShiftActive;
                renderKeyboard();
            } else if (key === 'backspace') {
                playerName = playerName.slice(0, -1);
                updatePlayerNameDisplay();
            } else if (key === 'enter') {
                if (playerName.length === 0) {
                    var display = document.getElementById('player-name-display');
                    display.classList.add('shake');
                    setTimeout(function() {
                        display.classList.remove('shake');
                    }, 300);
                    return;
                }
                
                if (playersList.indexOf(playerName) === -1) {
                    playersList.push(playerName);
                    savePlayersList();
                }
                
                selectedPlayerIndex = playersList.indexOf(playerName);
                renderPlayersList();
                showScreen('adminPlayers');
            } else {
                if (playerName.length < 15) {
                    var letter = e.target.textContent;
                    playerName += letter;
                    updatePlayerNameDisplay();
                }
            }
        });
        
        document.getElementById('change-player-button').addEventListener('click', function() {
            playSound('click');
            selectedPlayerIndex = -1;
            showScreen('adminPlayers');
            renderPlayersList();
        });
        
        document.getElementById('achievements-button').addEventListener('click', function() {
            playSound('click');
            renderAchievements();
            showScreen('achievements');
        });
        
        document.getElementById('back-from-achievements').addEventListener('click', function() {
            playSound('click');
            showScreen('levels');
        });
        
        document.getElementById('back-to-levels').addEventListener('click', function() {
            playSound('click');
            showScreen('levels');
            populateLevelsScreen();
        });
        
        document.getElementById('settings-button').addEventListener('click', function(e) {
            e.stopPropagation();
            playSound('click');
            var dropdown = document.getElementById('settings-dropdown');
            dropdown.classList.toggle('active');
        });
        
        document.addEventListener('click', function(e) {
            var dropdown = document.getElementById('settings-dropdown');
            var settingsMenu = document.getElementById('settings-menu');
            
            if (!settingsMenu.contains(e.target)) {
                dropdown.classList.remove('active');
            }
        });
        
        document.getElementById('toggle-sound').addEventListener('click', function() {
            gameState.soundEnabled = !gameState.soundEnabled;
            document.getElementById('sound-status').textContent = gameState.soundEnabled ? 'ON' : 'OFF';
            playSound('click');
        });
        
        document.getElementById('return-menu').addEventListener('click', function() {
            playSound('click');
            gameState.inGame = false;
            stopTimer(); // NUEVO V8: Detener cron√≥metro al salir
            showScreen('levels');
            populateLevelsScreen();
            document.getElementById('settings-dropdown').classList.remove('active');
        });
        
        // MEJORA V9: Event listeners para los botones del K-PAD
        document.getElementById('k-pad-reset').addEventListener('click', function() {
            playSound('click');
            if (gameState.inGame) {
                stopTimer();
                loadLevel(gameState.currentLevel);
            }
        });
        
        // NUEVO: Event listener para el bot√≥n de salir al men√∫
        document.getElementById('exit-level-btn').addEventListener('click', function() {
            playSound('click');
            gameState.inGame = false;
            stopTimer();
            showScreen('levels');
            populateLevelsScreen();
        });
        
        var kPadButtons = document.querySelectorAll('.k-pad-btn[data-direction]');
        for (var i = 0; i < kPadButtons.length; i++) {
            kPadButtons[i].addEventListener('click', function() {
                if (!gameState.inGame) return;
                
                var direction = this.getAttribute('data-direction');
                playSound('move');
                
                if (direction === 'up') {
                    handleInput(0, -1);
                } else if (direction === 'down') {
                    handleInput(0, 1);
                } else if (direction === 'left') {
                    handleInput(-1, 0);
                } else if (direction === 'right') {
                    handleInput(1, 0);
                }
            });
        }
        
        // MEJORA V7.1: Men√∫ de configuraci√≥n para pantalla de niveles
        document.getElementById('levels-settings-button').addEventListener('click', function(e) {
            e.stopPropagation();
            playSound('click');
            var dropdown = document.getElementById('levels-settings-dropdown');
            dropdown.classList.toggle('active');
        });
        
        document.addEventListener('click', function(e) {
            var dropdown = document.getElementById('levels-settings-dropdown');
            var settingsMenu = document.getElementById('levels-settings-menu');
            
            if (settingsMenu && !settingsMenu.contains(e.target)) {
                dropdown.classList.remove('active');
            }
        });
        
        document.getElementById('levels-toggle-sound').addEventListener('click', function() {
            gameState.soundEnabled = !gameState.soundEnabled;
            document.getElementById('levels-sound-status').textContent = gameState.soundEnabled ? 'ON' : 'OFF';
            // Tambi√©n actualizar el otro indicador de sonido si existe
            var soundStatus = document.getElementById('sound-status');
            if (soundStatus) {
                soundStatus.textContent = gameState.soundEnabled ? 'ON' : 'OFF';
            }
            playSound('click');
        });
        
        document.getElementById('levels-exit-game').addEventListener('click', function() {
            playSound('click');
            // Intentar cerrar la ventana/pesta√±a
            if (confirm('¬øDeseas salir del juego? Esta acci√≥n cerrar√° la ventana.')) {
                // Intentar cerrar la ventana
                window.close();
                // Si no se puede cerrar, mostrar mensaje
                setTimeout(function() {
                    alert('No se puede cerrar la ventana autom√°ticamente. Por favor, cierra manualmente la pesta√±a.');
                }, 100);
            }
        });
        
        // CORREGIDO V9.1: Event listener con validaci√≥n de nivel desbloqueado
        var levelsGridElement = document.getElementById('levels-grid');
        if (levelsGridElement) {
            levelsGridElement.addEventListener('click', function(e) {
                var levelButton = e.target.closest('.level-button');
                if (!levelButton) return;
                
                // NUEVO V9.1: No hacer nada si el nivel est√° bloqueado
                if (levelButton.classList.contains('locked')) {
                    playSound('error');
                    console.log('Nivel bloqueado'); // DEBUG
                    return;
                }
                
                playSound('click');
                
                var levelIndex = parseInt(levelButton.getAttribute('data-level-index'));
                console.log('Nivel seleccionado:', levelIndex); // DEBUG
                
                if (isNaN(levelIndex) || levelIndex < 0 || levelIndex >= levelPuzzles.length) {
                    console.error('√çndice de nivel inv√°lido:', levelIndex);
                    return;
                }
                
                // NUEVO V9.1: Doble verificaci√≥n de desbloqueo
                var progress = getCurrentPlayerProgress();
                if (!isLevelUnlocked(levelIndex, progress)) {
                    playSound('error');
                    console.log('Nivel no desbloqueado'); // DEBUG
                    return;
                }
                
                gameState.currentLevel = levelIndex;
                
                loadLevel(levelIndex);
                showScreen('juego');
                gameState.inGame = true;
                updateSideHud();
            });
        } else {
            console.error('No se encontr√≥ el elemento levels-grid');
        }
        
        document.addEventListener('keydown', function(e) {
            if (!gameState.inGame) return;
            
            var key = e.key.toLowerCase();
            
            if (key === 'arrowup' || key === 'w') {
                e.preventDefault();
                handleInput(0, -1);
            } else if (key === 'arrowdown' || key === 's') {
                e.preventDefault();
                handleInput(0, 1);
            } else if (key === 'arrowleft' || key === 'a') {
                e.preventDefault();
                handleInput(-1, 0);
            } else if (key === 'arrowright' || key === 'd') {
                e.preventDefault();
                handleInput(1, 0);
            } else if (key === 'r') {
                e.preventDefault();
                loadLevel(gameState.currentLevel);
            }
        });
        
        document.getElementById('d-pad-up').addEventListener('click', function() {
            handleInput(0, -1);
        });
        
        document.getElementById('d-pad-down').addEventListener('click', function() {
            handleInput(0, 1);
        });
        
        document.getElementById('d-pad-left').addEventListener('click', function() {
            handleInput(-1, 0);
        });
        
        document.getElementById('d-pad-right').addEventListener('click', function() {
            handleInput(1, 0);
        });
        
        document.addEventListener('fullscreenchange', checkFullscreenStatus);
        document.addEventListener('webkitfullscreenchange', checkFullscreenStatus);
        document.addEventListener('mozfullscreenchange', checkFullscreenStatus);
        document.addEventListener('msfullscreenchange', checkFullscreenStatus);
        
        document.getElementById('return-fullscreen-button').addEventListener('click', function() {
            playSound('click');
            enterFullscreen();
        });
        
        function init() {
            initAudio();
            loadPlayersList();
            loadProfiles();
            createVirtualKeyboard();
            
            updateStartButton();
            
            setTimeout(function() {
                showScreen('adminPlayers');
                renderPlayersList();
            }, 1500);
        }
        
        init();
        
    })();
    </script>
</body>
</html>
